{"version":3,"file":"static/js/83.5610e099.chunk.js","mappings":"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","sources":["../node_modules/@babel/runtime/helpers/esm/typeof.js","../node_modules/@babel/runtime/helpers/esm/toPropertyKey.js","../node_modules/@babel/runtime/helpers/esm/toPrimitive.js","../node_modules/@babel/runtime/helpers/esm/defineProperty.js","../node_modules/@babel/runtime/helpers/esm/objectSpread2.js","../node_modules/@babel/runtime/helpers/esm/arrayLikeToArray.js","../node_modules/@babel/runtime/helpers/esm/toConsumableArray.js","../node_modules/@babel/runtime/helpers/esm/arrayWithoutHoles.js","../node_modules/@babel/runtime/helpers/esm/iterableToArray.js","../node_modules/@babel/runtime/helpers/esm/unsupportedIterableToArray.js","../node_modules/@babel/runtime/helpers/esm/nonIterableSpread.js","functions/scenarios.tsx","functions/analysis/calculateTotalImpact.ts","functions/analysis/calculateTotalProbability.ts","functions/analysis/calculateTotalRisk.ts","types/dataverse/DVAnalysisRun.ts","types/dataverse/DVRiskFile.ts","functions/Impact.tsx","functions/Probability.tsx","types/dataverse/DVDirectAnalysis.ts","functions/inputProcessing.ts","functions/analysis/prepareRiskFiles.ts","functions/analysis/runAnalysis.ts","functions/analysis/calculator.worker.ts"],"sourcesContent":["export default function _typeof(o) {\n  \"@babel/helpers - typeof\";\n\n  return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) {\n    return typeof o;\n  } : function (o) {\n    return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o;\n  }, _typeof(o);\n}","import _typeof from \"./typeof.js\";\nimport toPrimitive from \"./toPrimitive.js\";\nexport default function _toPropertyKey(arg) {\n  var key = toPrimitive(arg, \"string\");\n  return _typeof(key) === \"symbol\" ? key : String(key);\n}","import _typeof from \"./typeof.js\";\nexport default function _toPrimitive(input, hint) {\n  if (_typeof(input) !== \"object\" || input === null) return input;\n  var prim = input[Symbol.toPrimitive];\n  if (prim !== undefined) {\n    var res = prim.call(input, hint || \"default\");\n    if (_typeof(res) !== \"object\") return res;\n    throw new TypeError(\"@@toPrimitive must return a primitive value.\");\n  }\n  return (hint === \"string\" ? String : Number)(input);\n}","import toPropertyKey from \"./toPropertyKey.js\";\nexport default function _defineProperty(obj, key, value) {\n  key = toPropertyKey(key);\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n  return obj;\n}","import defineProperty from \"./defineProperty.js\";\nfunction ownKeys(e, r) {\n  var t = Object.keys(e);\n  if (Object.getOwnPropertySymbols) {\n    var o = Object.getOwnPropertySymbols(e);\n    r && (o = o.filter(function (r) {\n      return Object.getOwnPropertyDescriptor(e, r).enumerable;\n    })), t.push.apply(t, o);\n  }\n  return t;\n}\nexport default function _objectSpread2(e) {\n  for (var r = 1; r < arguments.length; r++) {\n    var t = null != arguments[r] ? arguments[r] : {};\n    r % 2 ? ownKeys(Object(t), !0).forEach(function (r) {\n      defineProperty(e, r, t[r]);\n    }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) {\n      Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r));\n    });\n  }\n  return e;\n}","export default function _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n  for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];\n  return arr2;\n}","import arrayWithoutHoles from \"./arrayWithoutHoles.js\";\nimport iterableToArray from \"./iterableToArray.js\";\nimport unsupportedIterableToArray from \"./unsupportedIterableToArray.js\";\nimport nonIterableSpread from \"./nonIterableSpread.js\";\nexport default function _toConsumableArray(arr) {\n  return arrayWithoutHoles(arr) || iterableToArray(arr) || unsupportedIterableToArray(arr) || nonIterableSpread();\n}","import arrayLikeToArray from \"./arrayLikeToArray.js\";\nexport default function _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return arrayLikeToArray(arr);\n}","export default function _iterableToArray(iter) {\n  if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter);\n}","import arrayLikeToArray from \"./arrayLikeToArray.js\";\nexport default function _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return arrayLikeToArray(o, minLen);\n}","export default function _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}","import { RiskCalculation } from \"../types/dataverse/DVAnalysisRun\";\r\nimport { IntensityParameter } from \"./intensityParameters\";\r\nimport tableToJson from \"./tableToJson\";\r\n\r\nexport enum SCENARIOS {\r\n  CONSIDERABLE = \"considerable\",\r\n  MAJOR = \"major\",\r\n  EXTREME = \"extreme\",\r\n}\r\n\r\nexport type SCENARIO_SUFFIX = \"_c\" | \"_m\" | \"_e\";\r\n\r\nexport interface Scenarios {\r\n  considerable: IntensityParameter<string>[];\r\n  major: IntensityParameter<string>[];\r\n  extreme: IntensityParameter<string>[];\r\n}\r\n\r\nexport const SCENARIO_PARAMS = {\r\n  [SCENARIOS.CONSIDERABLE]: {\r\n    titleI18N: \"2A.progress.considerable.title\",\r\n    titleDefault: \"Considerable\",\r\n    color: \"#9DC3E6\",\r\n    prefix: \"c\",\r\n  },\r\n  [SCENARIOS.MAJOR]: { titleI18N: \"2A.progress.major.title\", titleDefault: \"Major\", color: \"#FFE699\", prefix: \"m\" },\r\n  [SCENARIOS.EXTREME]: {\r\n    titleI18N: \"2A.progress.extreme.title\",\r\n    titleDefault: \"Extreme\",\r\n    color: \"#F47C7C\",\r\n    prefix: \"e\",\r\n  },\r\n};\r\n\r\nconst noScenarios = {\r\n  considerable: [],\r\n  major: [],\r\n  extreme: [],\r\n};\r\n\r\nexport const unwrapScenario = (scenario: string, parameters: IntensityParameter[]) => {\r\n  try {\r\n    return JSON.parse(scenario);\r\n  } catch (e) {\r\n    // Old HTML format\r\n    const json = tableToJson(scenario);\r\n\r\n    if (!json) return [];\r\n\r\n    if (parameters.length <= 0)\r\n      return [\r\n        {\r\n          name: \"Capacity\",\r\n          description: \"Actor capacity\",\r\n          value: json[0][0],\r\n        },\r\n      ];\r\n\r\n    return parameters.map((p, i) => ({\r\n      ...p,\r\n      value: json[i],\r\n    }));\r\n  }\r\n};\r\n\r\nexport function unwrap(\r\n  parameters: IntensityParameter[],\r\n  considerable: string | null,\r\n  major: string | null,\r\n  extreme: string | null\r\n): Scenarios {\r\n  if (!considerable || !major || !extreme) return noScenarios;\r\n\r\n  return {\r\n    considerable: unwrapScenario(considerable, parameters),\r\n    major: unwrapScenario(major, parameters),\r\n    extreme: unwrapScenario(extreme, parameters),\r\n  };\r\n}\r\n\r\nexport function wrap(scenario: IntensityParameter<string>[]): string {\r\n  return JSON.stringify(scenario);\r\n}\r\n\r\nexport function scenariosEquals(a?: Scenarios, b?: Scenarios) {\r\n  // TODO\r\n  return false;\r\n}\r\n\r\nexport const getScenarioSuffix = (scenario: SCENARIOS): SCENARIO_SUFFIX => {\r\n  if (scenario === SCENARIOS.CONSIDERABLE) return \"_c\";\r\n  else if (scenario === SCENARIOS.MAJOR) return \"_m\";\r\n  return \"_e\";\r\n};\r\n\r\nexport const getWorstCaseScenario = (calculation: RiskCalculation) => {\r\n  const rs = [\r\n    calculation.tp_c * calculation.ti_c,\r\n    calculation.tp_m * calculation.ti_m,\r\n    calculation.tp_e * calculation.ti_e,\r\n  ];\r\n\r\n  return [SCENARIOS.CONSIDERABLE, SCENARIOS.MAJOR, SCENARIOS.EXTREME][rs.indexOf(Math.max(...rs))];\r\n};\r\n","import { CascadeCalculation, RiskCalculation } from \"../../types/dataverse/DVAnalysisRun\";\r\nimport { SCENARIOS } from \"../scenarios\";\r\n\r\nconst DAMAGE_INDICATORS = [\"Ha\", \"Hb\", \"Hc\", \"Sa\", \"Sb\", \"Sc\", \"Sd\", \"Ea\", \"Fa\", \"Fb\"];\r\n\r\nconst INFO_OPS_FACTOR = 10;\r\n\r\nconst getScenarioSuffix = (scenario: SCENARIOS) => {\r\n  if (scenario === SCENARIOS.CONSIDERABLE) return \"_c\";\r\n  else if (scenario === SCENARIOS.MAJOR) return \"_m\";\r\n  return \"_e\";\r\n};\r\n\r\nconst getDI = (risk: RiskCalculation, scenario: SCENARIOS) => {\r\n  if (scenario === SCENARIOS.CONSIDERABLE) return risk.di_c;\r\n  if (scenario === SCENARIOS.MAJOR) return risk.di_m;\r\n  return risk.di_e;\r\n};\r\n\r\nconst getII = (cascade: CascadeCalculation, scenario: SCENARIOS) => {\r\n  if (scenario === SCENARIOS.CONSIDERABLE) return cascade.ii_c;\r\n  if (scenario === SCENARIOS.MAJOR) return cascade.ii_m;\r\n  return cascade.ii_e;\r\n};\r\n\r\nconst setIndirectImpacts = (\r\n  cascade: CascadeCalculation,\r\n  scenario: SCENARIOS,\r\n  s2c: number,\r\n  s2m: number,\r\n  s2e: number\r\n) => {\r\n  let suffix = getScenarioSuffix(scenario);\r\n\r\n  DAMAGE_INDICATORS.forEach((d) => {\r\n    //@ts-expect-error\r\n    cascade[`ii_${d}${suffix}` as keyof CascadeCalculation] =\r\n      s2c * (cascade.effect[`ti_${d}_c` as keyof RiskCalculation] as number) +\r\n      s2m * (cascade.effect[`ti_${d}_m` as keyof RiskCalculation] as number) +\r\n      s2e * (cascade.effect[`ti_${d}_e` as keyof RiskCalculation] as number);\r\n  });\r\n\r\n  //@ts-expect-error\r\n  cascade[`ii${suffix}` as keyof CascadeCalculation] =\r\n    s2c * (cascade.effect[`ti_c` as keyof RiskCalculation] as number) +\r\n    s2m * (cascade.effect[`ti_m` as keyof RiskCalculation] as number) +\r\n    s2e * (cascade.effect[`ti_e` as keyof RiskCalculation] as number);\r\n};\r\n\r\nconst getCP = (cascade: CascadeCalculation, fromScenario: SCENARIOS, toScenario: SCENARIOS) => {\r\n  if (fromScenario === SCENARIOS.CONSIDERABLE && toScenario === SCENARIOS.CONSIDERABLE) return cascade.c2c;\r\n  if (fromScenario === SCENARIOS.CONSIDERABLE && toScenario === SCENARIOS.MAJOR) return cascade.c2m;\r\n  if (fromScenario === SCENARIOS.CONSIDERABLE && toScenario === SCENARIOS.EXTREME) return cascade.c2e;\r\n  if (fromScenario === SCENARIOS.MAJOR && toScenario === SCENARIOS.CONSIDERABLE) return cascade.m2c;\r\n  if (fromScenario === SCENARIOS.MAJOR && toScenario === SCENARIOS.MAJOR) return cascade.m2m;\r\n  if (fromScenario === SCENARIOS.MAJOR && toScenario === SCENARIOS.EXTREME) return cascade.m2e;\r\n  if (fromScenario === SCENARIOS.EXTREME && toScenario === SCENARIOS.CONSIDERABLE) return cascade.e2c;\r\n  if (fromScenario === SCENARIOS.EXTREME && toScenario === SCENARIOS.MAJOR) return cascade.e2m;\r\n  return cascade.e2e;\r\n};\r\n\r\nexport const getEffectGraph = (risk: RiskCalculation) => {\r\n  return {\r\n    ...risk,\r\n    effects: getEffectGraphRecurse(risk.effects, [risk.riskId]),\r\n  };\r\n};\r\n\r\nexport const getEffectGraphRecurse = (\r\n  cascades: CascadeCalculation[],\r\n  visitedRiskIds: string[] = []\r\n): CascadeCalculation[] => {\r\n  if (cascades.length <= 0) return [];\r\n\r\n  const nextLevel: CascadeCalculation[] = [];\r\n  const nextVisitedIds = [...visitedRiskIds, ...cascades.map((c) => c.effect.riskId)];\r\n\r\n  cascades.forEach((c1) => {\r\n    c1.effect.effects.forEach((c2) => {\r\n      if (nextVisitedIds.indexOf(c2.effect.riskId) < 0) {\r\n        nextLevel.push(c2);\r\n      }\r\n    });\r\n  });\r\n\r\n  const nextLevelEffects = getEffectGraphRecurse(nextLevel, nextVisitedIds);\r\n\r\n  return cascades.map((c1) => ({\r\n    ...c1,\r\n    effect: {\r\n      ...c1.effect,\r\n      effects: c1.effect.effects.reduce((filteredEffects, c2) => {\r\n        const nextLevelEffect = nextLevelEffects.find((c3) => c2.effect.riskId === c3.effect.riskId);\r\n\r\n        if (!nextLevelEffect) return filteredEffects;\r\n\r\n        return [...filteredEffects, { ...c2, effect: nextLevelEffect.effect }];\r\n      }, [] as CascadeCalculation[]),\r\n    },\r\n  }));\r\n};\r\n\r\nexport default function calculateTotalImpact(risk: RiskCalculation): void {\r\n  calculateTotalImpactScenario(risk, SCENARIOS.CONSIDERABLE);\r\n  calculateTotalImpactScenario(risk, SCENARIOS.MAJOR);\r\n  calculateTotalImpactScenario(risk, SCENARIOS.EXTREME);\r\n}\r\n\r\nfunction calculateTotalImpactScenario(risk: RiskCalculation, scenario: SCENARIOS) {\r\n  let suffix = getScenarioSuffix(scenario);\r\n\r\n  //@ts-expect-error\r\n  risk[`ti${suffix}` as keyof RiskCalculation] =\r\n    getDI(risk, scenario) +\r\n    risk.effects.reduce((iiTot, cascade) => {\r\n      if (cascade.effect.ti <= 0) {\r\n        calculateTotalImpact(cascade.effect);\r\n      }\r\n\r\n      // const cp0 =\r\n      //   (1 - getCP(cascade, scenario, SCENARIOS.CONSIDERABLE)) *\r\n      //   (1 - getCP(cascade, scenario, SCENARIOS.MAJOR)) *\r\n      //   (1 - getCP(cascade, scenario, SCENARIOS.EXTREME));\r\n      // const cpTot =\r\n      //   getCP(cascade, scenario, SCENARIOS.CONSIDERABLE) +\r\n      //     getCP(cascade, scenario, SCENARIOS.MAJOR) +\r\n      //     getCP(cascade, scenario, SCENARIOS.EXTREME) || 0.0000001;\r\n\r\n      // const s2c = (1 - cp0) * (getCP(cascade, scenario, SCENARIOS.CONSIDERABLE) / cpTot);\r\n      // const s2m = (1 - cp0) * (getCP(cascade, scenario, SCENARIOS.MAJOR) / cpTot);\r\n      // const s2e = (1 - cp0) * (getCP(cascade, scenario, SCENARIOS.EXTREME) / cpTot);\r\n\r\n      setIndirectImpacts(\r\n        cascade,\r\n        scenario,\r\n        getCP(cascade, scenario, SCENARIOS.CONSIDERABLE),\r\n        getCP(cascade, scenario, SCENARIOS.MAJOR),\r\n        getCP(cascade, scenario, SCENARIOS.EXTREME)\r\n      );\r\n\r\n      return iiTot + getII(cascade, scenario);\r\n    }, 0);\r\n\r\n  DAMAGE_INDICATORS.forEach((d) => {\r\n    //@ts-expect-error\r\n    risk[`ti_${d}${suffix}` as keyof RiskCalculation] =\r\n      (risk[`di_${d}${suffix}` as keyof RiskCalculation] as number) +\r\n      risk.effects.reduce((tot, cascade) => {\r\n        return tot + (cascade[`ii_${d}${suffix}` as keyof CascadeCalculation] as number);\r\n      }, 0);\r\n  });\r\n\r\n  risk.ti = -1;\r\n}\r\n","import { CascadeCalculation, RiskCalculation } from \"../../types/dataverse/DVAnalysisRun\";\r\nimport { SCENARIOS } from \"../scenarios\";\r\n\r\nconst INFO_OPS_FACTOR = 10;\r\n\r\nconst getDP = (risk: RiskCalculation, scenario: SCENARIOS) => {\r\n  if (scenario === SCENARIOS.CONSIDERABLE) return risk.dp_c;\r\n  if (scenario === SCENARIOS.MAJOR) return risk.dp_m;\r\n  return risk.dp_e;\r\n};\r\n\r\nconst getDP50 = (risk: RiskCalculation, scenario: SCENARIOS) => {\r\n  if (scenario === SCENARIOS.CONSIDERABLE) return risk.dp50_c;\r\n  if (scenario === SCENARIOS.MAJOR) return risk.dp50_m;\r\n  return risk.dp50_e;\r\n};\r\n\r\nconst getIP = (cascade: CascadeCalculation, scenario: SCENARIOS) => {\r\n  if (scenario === SCENARIOS.CONSIDERABLE) return cascade.ip_c;\r\n  if (scenario === SCENARIOS.MAJOR) return cascade.ip_m;\r\n  return cascade.ip_e;\r\n};\r\n\r\nconst getIP50 = (cascade: CascadeCalculation, scenario: SCENARIOS) => {\r\n  if (scenario === SCENARIOS.CONSIDERABLE) return cascade.ip50_c;\r\n  if (scenario === SCENARIOS.MAJOR) return cascade.ip50_m;\r\n  return cascade.ip50_e;\r\n};\r\n\r\nconst setIP = (cascade: CascadeCalculation, scenario: SCENARIOS, ip: number) => {\r\n  if (scenario === SCENARIOS.CONSIDERABLE) cascade.ip_c = ip;\r\n  if (scenario === SCENARIOS.MAJOR) cascade.ip_m = ip;\r\n  if (scenario === SCENARIOS.EXTREME) cascade.ip_e = ip;\r\n};\r\n\r\nconst setIP50 = (cascade: CascadeCalculation, scenario: SCENARIOS, ip: number) => {\r\n  if (scenario === SCENARIOS.CONSIDERABLE) cascade.ip50_c = ip;\r\n  if (scenario === SCENARIOS.MAJOR) cascade.ip50_m = ip;\r\n  if (scenario === SCENARIOS.EXTREME) cascade.ip50_e = ip;\r\n};\r\n\r\nconst getCP = (cascade: CascadeCalculation, fromScenario: SCENARIOS, toScenario: SCENARIOS) => {\r\n  if (fromScenario === SCENARIOS.CONSIDERABLE && toScenario === SCENARIOS.CONSIDERABLE) return cascade.c2c;\r\n  if (fromScenario === SCENARIOS.CONSIDERABLE && toScenario === SCENARIOS.MAJOR) return cascade.c2m;\r\n  if (fromScenario === SCENARIOS.CONSIDERABLE && toScenario === SCENARIOS.EXTREME) return cascade.c2e;\r\n  if (fromScenario === SCENARIOS.MAJOR && toScenario === SCENARIOS.CONSIDERABLE) return cascade.m2c;\r\n  if (fromScenario === SCENARIOS.MAJOR && toScenario === SCENARIOS.MAJOR) return cascade.m2m;\r\n  if (fromScenario === SCENARIOS.MAJOR && toScenario === SCENARIOS.EXTREME) return cascade.m2e;\r\n  if (fromScenario === SCENARIOS.EXTREME && toScenario === SCENARIOS.CONSIDERABLE) return cascade.e2c;\r\n  if (fromScenario === SCENARIOS.EXTREME && toScenario === SCENARIOS.MAJOR) return cascade.e2m;\r\n  return cascade.e2e;\r\n};\r\n\r\nexport const getCausalGraph = (risk: RiskCalculation) => {\r\n  return {\r\n    ...risk,\r\n    causes: getCausalGraphRecurse(risk.causes, [risk.riskId]),\r\n  };\r\n};\r\n\r\nexport const getCausalGraphRecurse = (\r\n  cascades: CascadeCalculation[],\r\n  visitedRiskIds: string[] = []\r\n): CascadeCalculation[] => {\r\n  if (cascades.length <= 0) return [];\r\n\r\n  const nextLevel: CascadeCalculation[] = [];\r\n  const nextVisitedIds = [...visitedRiskIds, ...cascades.map((c) => c.cause.riskId)];\r\n\r\n  cascades.forEach((c1) => {\r\n    c1.cause.causes.forEach((c2) => {\r\n      if (nextVisitedIds.indexOf(c2.cause.riskId) < 0) {\r\n        nextLevel.push(c2);\r\n      }\r\n    });\r\n  });\r\n\r\n  const nextLevelCauses = getCausalGraphRecurse(nextLevel, nextVisitedIds);\r\n\r\n  return cascades.map((c1) => ({\r\n    ...c1,\r\n    cause: {\r\n      ...c1.cause,\r\n      causes: c1.cause.causes.reduce((filteredCauses, c2) => {\r\n        const nextLevelCause = nextLevelCauses.find((c3) => c2.cause.riskId === c3.cause.riskId);\r\n\r\n        if (!nextLevelCause) return filteredCauses;\r\n\r\n        return [...filteredCauses, { ...c2, cause: nextLevelCause.cause }];\r\n      }, [] as CascadeCalculation[]),\r\n    },\r\n  }));\r\n};\r\n\r\nexport default function calculateTotalProbability(risk: RiskCalculation): void {\r\n  risk.tp_c = calculateTotalProbabilityScenario(risk, SCENARIOS.CONSIDERABLE);\r\n  risk.tp_m = calculateTotalProbabilityScenario(risk, SCENARIOS.MAJOR);\r\n  risk.tp_e = calculateTotalProbabilityScenario(risk, SCENARIOS.EXTREME);\r\n\r\n  risk.tp = -1;\r\n\r\n  risk.tp50_c = calculateTotalProbability2050Scenario(risk, SCENARIOS.CONSIDERABLE);\r\n  risk.tp50_m = calculateTotalProbability2050Scenario(risk, SCENARIOS.MAJOR);\r\n  risk.tp50_e = calculateTotalProbability2050Scenario(risk, SCENARIOS.EXTREME);\r\n\r\n  risk.tp50 = -1;\r\n}\r\n\r\nfunction calculateTotalProbabilityScenario(risk: RiskCalculation, scenario: SCENARIOS): number {\r\n  return (\r\n    getDP(risk, scenario) +\r\n    risk.causes.reduce((ipTot, cascade) => {\r\n      if (cascade.cause.tp <= 0) {\r\n        calculateTotalProbability(cascade.cause);\r\n      }\r\n\r\n      setIP(\r\n        cascade,\r\n        scenario,\r\n        cascade.cause.tp_c * getCP(cascade, SCENARIOS.CONSIDERABLE, scenario) +\r\n          cascade.cause.tp_m * getCP(cascade, SCENARIOS.MAJOR, scenario) +\r\n          cascade.cause.tp_e * getCP(cascade, SCENARIOS.EXTREME, scenario)\r\n      );\r\n\r\n      cascade.ip = -1;\r\n\r\n      return ipTot + getIP(cascade, scenario);\r\n    }, 0)\r\n  );\r\n}\r\n\r\nfunction calculateTotalProbability2050Scenario(risk: RiskCalculation, scenario: SCENARIOS): number {\r\n  return (\r\n    getDP50(risk, scenario) +\r\n    risk.causes.reduce((ipTot, cascade) => {\r\n      if (cascade.cause.tp50 <= 0) {\r\n        calculateTotalProbability(cascade.cause);\r\n      }\r\n\r\n      setIP50(\r\n        cascade,\r\n        scenario,\r\n        cascade.cause.tp50_c * getCP(cascade, SCENARIOS.CONSIDERABLE, scenario) +\r\n          cascade.cause.tp50_m * getCP(cascade, SCENARIOS.MAJOR, scenario) +\r\n          cascade.cause.tp50_e * getCP(cascade, SCENARIOS.EXTREME, scenario)\r\n      );\r\n\r\n      cascade.ip50 = -1;\r\n\r\n      return ipTot + getIP50(cascade, scenario);\r\n    }, 0)\r\n  );\r\n}\r\n","import { M } from \"../../pages/learning/QuantitativeScales/M\";\r\nimport { RiskCalculation } from \"../../types/dataverse/DVAnalysisRun\";\r\nimport { getScenarioSuffix, getWorstCaseScenario } from \"../scenarios\";\r\n\r\nconst DAMAGE_INDICATORS = [\"Ha\", \"Hb\", \"Hc\", \"Sa\", \"Sb\", \"Sc\", \"Sd\", \"Ea\", \"Fa\", \"Fb\"];\r\n\r\nexport const getYearlyRisk = (dailyP: number, ti: number) => {\r\n  const yearlyP = 1 - Math.pow(1 - dailyP, 365);\r\n\r\n  return yearlyP * ti;\r\n};\r\n\r\nexport default function calculateTotalRisk(r: RiskCalculation) {\r\n  r.tr_c = r.tp_c * r.ti_c;\r\n  r.tr_m = r.tp_m * r.ti_m;\r\n  r.tr_e = r.tp_e * r.ti_e;\r\n\r\n  r.tr = (r.tr_c + r.tr_m + r.tr_e) / 3;\r\n\r\n  r.tr50_c = r.tp50_c * r.ti_c;\r\n  r.tr50_m = r.tp50_m * r.ti_m;\r\n  r.tr50_e = r.tp50_e * r.ti_e;\r\n\r\n  r.tr50 = (r.tr50_c + r.tr50_m + r.tr50_e) / 3;\r\n\r\n  r.causes.forEach((c) => {\r\n    c.ir_c = r.tp_c === 0 ? 0 : (r.tr_c * c.ip_c) / r.tp_c;\r\n    c.ir_m = r.tp_m === 0 ? 0 : (r.tr_m * c.ip_m) / r.tp_m;\r\n    c.ir_e = r.tp_e === 0 ? 0 : (r.tr_e * c.ip_e) / r.tp_e;\r\n\r\n    c.ir = (c.ir_c + c.ir_m + c.ir_e) / 3;\r\n\r\n    c.ir50_c = r.tp50_c === 0 ? 0 : (r.tr50_c * c.ip50_c) / r.tp50_c;\r\n    c.ir50_m = r.tp50_m === 0 ? 0 : (r.tr50_m * c.ip50_m) / r.tp50_m;\r\n    c.ir50_e = r.tp50_e === 0 ? 0 : (r.tr50_e * c.ip50_e) / r.tp50_e;\r\n\r\n    c.ir50 = (c.ir50_c + c.ir50_m + c.ir50_e) / 3;\r\n  });\r\n\r\n  r.effects.forEach((c) => {\r\n    c.ir_c = r.ti_c === 0 ? 0 : r.tr_c * (c.ii_c / r.ti_c);\r\n    c.ir_m = r.ti_m === 0 ? 0 : r.tr_m * (c.ii_m / r.ti_m);\r\n    c.ir_e = r.ti_e === 0 ? 0 : r.tr_e * (c.ii_e / r.ti_e);\r\n\r\n    c.ir = (c.ir_c + c.ir_m + c.ir_e) / 3;\r\n  });\r\n\r\n  const wcsSuffix = getScenarioSuffix(getWorstCaseScenario(r));\r\n\r\n  r.dp = r[`dp${wcsSuffix}`];\r\n  r.tp = r[`tp${wcsSuffix}`];\r\n\r\n  r.dp50 = r[`dp50${wcsSuffix}`];\r\n  r.tp50 = r[`tp50${wcsSuffix}`];\r\n\r\n  r.causes.forEach((c) => {\r\n    c.ip = c[`ip${wcsSuffix}`];\r\n    c.ip50 = c[`ip50${wcsSuffix}`];\r\n  });\r\n\r\n  r.di = r[`di${wcsSuffix}`];\r\n  r.ti = r[`ti${wcsSuffix}`];\r\n\r\n  DAMAGE_INDICATORS.forEach((d) => {\r\n    //@ts-expect-error\r\n    r[`ti_${d}`] = r[`ti_${d}${wcsSuffix}`];\r\n  });\r\n\r\n  r.effects.forEach((c) => {\r\n    c.ii = c[`ii${wcsSuffix}`];\r\n  });\r\n}\r\n","export enum Quality {\r\n  CONSENSUS = \"consensus\",\r\n  AVERAGE = \"average\",\r\n  MISSING = \"no input\",\r\n}\r\n\r\nexport interface DVAnalysisRun<RiskFileType = unknown, RiskCalculationType = RiskCalculation> {\r\n  cr4de_bnraanalysisrunid: string;\r\n\r\n  cr4de_risk_file: RiskFileType;\r\n  _cr4de_risk_file_value: string;\r\n\r\n  cr4de_analysis_id: string;\r\n\r\n  // Should only be !null when risk_file is null\r\n  cr4de_metrics: AnalysisMetrics | null;\r\n  // Should be null when risk_file is null\r\n  cr4de_results: RiskCalculationType | null;\r\n  // Should be null when risk_file is null\r\n  cr4de_risk_file_metrics: RiskFileMetrics | null;\r\n\r\n  createdon: Date;\r\n}\r\n\r\nexport interface RiskAnalysisResults<RiskFileType = unknown> extends DVAnalysisRun<RiskFileType> {\r\n  cr4de_metrics: null;\r\n  cr4de_results: RiskCalculation;\r\n  cr4de_risk_file_metrics: RiskFileMetrics;\r\n}\r\n\r\nexport interface RiskAnalysisMetrics {\r\n  cr4de_metrics: AnalysisMetrics;\r\n  cr4de_results: null;\r\n}\r\n\r\nexport interface AnalysisMetrics {\r\n  performance: {\r\n    runtime_s: number;\r\n  };\r\n  quality: {\r\n    directAnalyses: {\r\n      consensus: number;\r\n      average: number;\r\n      zeroed: number;\r\n      total: number;\r\n    };\r\n    cascadeAnalyses: {\r\n      consensus: number;\r\n      average: number;\r\n      zoroed: number;\r\n      total: number;\r\n    };\r\n  };\r\n}\r\n\r\nexport interface CascadeCalculation {\r\n  // The object holding the calculated fields for the causing risk\r\n  cause: RiskCalculation;\r\n  effect: RiskCalculation;\r\n\r\n  quality: Quality;\r\n\r\n  // database id of the causing risk cascade\r\n  cascadeId: string;\r\n\r\n  // title of the causing risk file\r\n  cascadeTitle: string;\r\n\r\n  // identifies this cascade as one that should be damped\r\n  damp: boolean;\r\n\r\n  // Conditional probabilities per scenario couple\r\n  c2c: number;\r\n  c2m: number;\r\n  c2e: number;\r\n  m2c: number;\r\n  m2m: number;\r\n  m2e: number;\r\n  e2c: number;\r\n  e2m: number;\r\n  e2e: number;\r\n\r\n  // Indirect probability of this cascade per scenario\r\n  ip_c: number;\r\n  ip_m: number;\r\n  ip_e: number;\r\n\r\n  // Total indirect probability of this cascade\r\n  ip: number;\r\n\r\n  ip50_c: number;\r\n  ip50_m: number;\r\n  ip50_e: number;\r\n\r\n  ip50: number;\r\n\r\n  // Indirect impact of this cascade damage indicator per scenario\r\n  ii_Ha_c: number;\r\n  ii_Hb_c: number;\r\n  ii_Hc_c: number;\r\n  ii_Sa_c: number;\r\n  ii_Sb_c: number;\r\n  ii_Sc_c: number;\r\n  ii_Sd_c: number;\r\n  ii_Ea_c: number;\r\n  ii_Fa_c: number;\r\n  ii_Fb_c: number;\r\n\r\n  ii_Ha_m: number;\r\n  ii_Hb_m: number;\r\n  ii_Hc_m: number;\r\n  ii_Sa_m: number;\r\n  ii_Sb_m: number;\r\n  ii_Sc_m: number;\r\n  ii_Sd_m: number;\r\n  ii_Ea_m: number;\r\n  ii_Fa_m: number;\r\n  ii_Fb_m: number;\r\n\r\n  ii_Ha_e: number;\r\n  ii_Hb_e: number;\r\n  ii_Hc_e: number;\r\n  ii_Sa_e: number;\r\n  ii_Sb_e: number;\r\n  ii_Sc_e: number;\r\n  ii_Sd_e: number;\r\n  ii_Ea_e: number;\r\n  ii_Fa_e: number;\r\n  ii_Fb_e: number;\r\n\r\n  // Indirect impact of this cascade damage indicator\r\n  ii_Ha: number;\r\n  ii_Hb: number;\r\n  ii_Hc: number;\r\n  ii_Sa: number;\r\n  ii_Sb: number;\r\n  ii_Sc: number;\r\n  ii_Sd: number;\r\n  ii_Ea: number;\r\n  ii_Fa: number;\r\n  ii_Fb: number;\r\n\r\n  ii_c: number;\r\n  ii_m: number;\r\n  ii_e: number;\r\n\r\n  // Total indirect impact of this cascade\r\n  ii: number;\r\n\r\n  ir_c: number;\r\n  ir_m: number;\r\n  ir_e: number;\r\n\r\n  ir: number;\r\n\r\n  ir50_c: number;\r\n  ir50_m: number;\r\n  ir50_e: number;\r\n\r\n  ir50: number;\r\n}\r\n\r\nexport interface RiskCalculationKnownFields {\r\n  // The quality of the base results for this risk file\r\n  quality: Quality;\r\n\r\n  // The reliability of the base results for this risk file [0,1]\r\n  reliability: number;\r\n\r\n  // Direct probability of each scenario\r\n  dp_c: number;\r\n  dp_m: number;\r\n  dp_e: number;\r\n\r\n  // Direct Impacts per damage indicator and per scenario\r\n  di_Ha_c: number;\r\n  di_Hb_c: number;\r\n  di_Hc_c: number;\r\n  di_Sa_c: number;\r\n  di_Sb_c: number;\r\n  di_Sc_c: number;\r\n  di_Sd_c: number;\r\n  di_Ea_c: number;\r\n  di_Fa_c: number;\r\n  di_Fb_c: number;\r\n\r\n  di_Ha_m: number;\r\n  di_Hb_m: number;\r\n  di_Hc_m: number;\r\n  di_Sa_m: number;\r\n  di_Sb_m: number;\r\n  di_Sc_m: number;\r\n  di_Sd_m: number;\r\n  di_Ea_m: number;\r\n  di_Fa_m: number;\r\n  di_Fb_m: number;\r\n\r\n  di_Ha_e: number;\r\n  di_Hb_e: number;\r\n  di_Hc_e: number;\r\n  di_Sa_e: number;\r\n  di_Sb_e: number;\r\n  di_Sc_e: number;\r\n  di_Sd_e: number;\r\n  di_Ea_e: number;\r\n  di_Fa_e: number;\r\n  di_Fb_e: number;\r\n\r\n  dp50_c: number;\r\n  dp50_m: number;\r\n  dp50_e: number;\r\n}\r\n\r\nexport interface RiskCalculation extends RiskCalculationKnownFields {\r\n  // The id of the risk that this calculation belongs to\r\n  riskId: string;\r\n\r\n  // Title of the risk file for debugging purposes\r\n  riskTitle: string;\r\n\r\n  keyRisk?: boolean;\r\n  code?: string;\r\n  category?: string;\r\n\r\n  // The time at which the analysis was executed\r\n  timestamp: number;\r\n\r\n  // Total direct probability\r\n  dp: number;\r\n\r\n  dp50: number;\r\n\r\n  // Indirect probabilities of each scenario\r\n  ip_c: number;\r\n  ip_m: number;\r\n  ip_e: number;\r\n\r\n  // Total indirect probability\r\n  ip: number;\r\n\r\n  ip50_c: number;\r\n  ip50_m: number;\r\n  ip50_e: number;\r\n\r\n  ip50: number;\r\n\r\n  // Total probabilities per scenario\r\n  tp_c: number;\r\n  tp_m: number;\r\n  tp_e: number;\r\n\r\n  // Total probability of the risk\r\n  tp: number;\r\n\r\n  tp50_c: number;\r\n  tp50_m: number;\r\n  tp50_e: number;\r\n\r\n  tp50: number;\r\n\r\n  // Relative probabilities of each scenario (normalized)\r\n  rp_c: number;\r\n  rp_m: number;\r\n  rp_e: number;\r\n\r\n  // Total direct impact per damage indicator\r\n  di_Ha: number;\r\n  di_Hb: number;\r\n  di_Hc: number;\r\n  di_Sa: number;\r\n  di_Sb: number;\r\n  di_Sc: number;\r\n  di_Sd: number;\r\n  di_Ea: number;\r\n  di_Fa: number;\r\n  di_Fb: number;\r\n\r\n  // Total direct impact per scenario\r\n  di_c: number;\r\n  di_m: number;\r\n  di_e: number;\r\n\r\n  // Total direct impact\r\n  di: number;\r\n\r\n  // Indirect Impacts per damage indicator and per scenario\r\n  ii_Ha_c: number;\r\n  ii_Hb_c: number;\r\n  ii_Hc_c: number;\r\n  ii_Sa_c: number;\r\n  ii_Sb_c: number;\r\n  ii_Sc_c: number;\r\n  ii_Sd_c: number;\r\n  ii_Ea_c: number;\r\n  ii_Fa_c: number;\r\n  ii_Fb_c: number;\r\n\r\n  ii_Ha_m: number;\r\n  ii_Hb_m: number;\r\n  ii_Hc_m: number;\r\n  ii_Sa_m: number;\r\n  ii_Sb_m: number;\r\n  ii_Sc_m: number;\r\n  ii_Sd_m: number;\r\n  ii_Ea_m: number;\r\n  ii_Fa_m: number;\r\n  ii_Fb_m: number;\r\n\r\n  ii_Ha_e: number;\r\n  ii_Hb_e: number;\r\n  ii_Hc_e: number;\r\n  ii_Sa_e: number;\r\n  ii_Sb_e: number;\r\n  ii_Sc_e: number;\r\n  ii_Sd_e: number;\r\n  ii_Ea_e: number;\r\n  ii_Fa_e: number;\r\n  ii_Fb_e: number;\r\n\r\n  // Total indirect impact per damage indicator\r\n  ii_Ha: number;\r\n  ii_Hb: number;\r\n  ii_Hc: number;\r\n  ii_Sa: number;\r\n  ii_Sb: number;\r\n  ii_Sc: number;\r\n  ii_Sd: number;\r\n  ii_Ea: number;\r\n  ii_Fa: number;\r\n  ii_Fb: number;\r\n\r\n  // Total indirect impact per scenario\r\n  ii_c: number;\r\n  ii_m: number;\r\n  ii_e: number;\r\n\r\n  // Total indirect impact\r\n  ii: number;\r\n\r\n  // Total Impacts per damage indicator and per scenario\r\n  ti_Ha_c: number;\r\n  ti_Hb_c: number;\r\n  ti_Hc_c: number;\r\n  ti_Sa_c: number;\r\n  ti_Sb_c: number;\r\n  ti_Sc_c: number;\r\n  ti_Sd_c: number;\r\n  ti_Ea_c: number;\r\n  ti_Fa_c: number;\r\n  ti_Fb_c: number;\r\n\r\n  ti_Ha_m: number;\r\n  ti_Hb_m: number;\r\n  ti_Hc_m: number;\r\n  ti_Sa_m: number;\r\n  ti_Sb_m: number;\r\n  ti_Sc_m: number;\r\n  ti_Sd_m: number;\r\n  ti_Ea_m: number;\r\n  ti_Fa_m: number;\r\n  ti_Fb_m: number;\r\n\r\n  ti_Ha_e: number;\r\n  ti_Hb_e: number;\r\n  ti_Hc_e: number;\r\n  ti_Sa_e: number;\r\n  ti_Sb_e: number;\r\n  ti_Sc_e: number;\r\n  ti_Sd_e: number;\r\n  ti_Ea_e: number;\r\n  ti_Fa_e: number;\r\n  ti_Fb_e: number;\r\n\r\n  // Total impact per damage indicator\r\n  ti_Ha: number;\r\n  ti_Hb: number;\r\n  ti_Hc: number;\r\n  ti_Sa: number;\r\n  ti_Sb: number;\r\n  ti_Sc: number;\r\n  ti_Sd: number;\r\n  ti_Ea: number;\r\n  ti_Fa: number;\r\n  ti_Fb: number;\r\n\r\n  // Total impact per scenario\r\n  ti_c: number;\r\n  ti_m: number;\r\n  ti_e: number;\r\n\r\n  // Total impact\r\n  ti: number;\r\n\r\n  // Risk\r\n  tr_c: number;\r\n  tr_m: number;\r\n  tr_e: number;\r\n\r\n  tr: number;\r\n\r\n  // Risk in 2050\r\n  tr50_c: number;\r\n  tr50_m: number;\r\n  tr50_e: number;\r\n\r\n  tr50: number;\r\n\r\n  causes: CascadeCalculation[];\r\n\r\n  effects: CascadeCalculation[];\r\n}\r\n\r\nexport interface RiskFileMetrics {\r\n  importance: {\r\n    causes: number;\r\n    effects: number;\r\n    total: number;\r\n  };\r\n\r\n  reliability: {\r\n    causes: number;\r\n    effects: number;\r\n    total: number;\r\n  };\r\n\r\n  divergence: {\r\n    directAnalysis: number;\r\n    cascadeAnalyses: number;\r\n    other: number;\r\n    total: number;\r\n  };\r\n}\r\n","import { DiscussionRequired } from \"../DiscussionRequired\";\r\nimport { DVAnalysisRun } from \"./DVAnalysisRun\";\r\n\r\nexport enum RISK_TYPE {\r\n  STANDARD = \"Standard Risk\",\r\n  MANMADE = \"Malicious Man-made Risk\",\r\n  EMERGING = \"Emerging Risk\",\r\n}\r\n\r\nexport enum CONSENSUS_TYPE {\r\n  MEETING = 0,\r\n  SILENCE = 1,\r\n  NONE = 2,\r\n}\r\n\r\nexport interface RiskFileEditableFields {\r\n  cr4de_definition: string | null;\r\n  cr4de_historical_events: string | null;\r\n  cr4de_intensity_parameters: string | null;\r\n  cr4de_scenario_considerable: string | null;\r\n  cr4de_scenario_major: string | null;\r\n  cr4de_scenario_extreme: string | null;\r\n  cr4de_horizon_analysis: string | null;\r\n  cr4de_legal_bases: string | null;\r\n  cr4de_roles_responsibilities: string | null;\r\n  cr4de_existing_measures: string | null;\r\n  cr4de_online_sources: string | null;\r\n}\r\n\r\nexport interface DiscussionsRequired {\r\n  dp_c: DiscussionRequired;\r\n  dp_m: DiscussionRequired;\r\n  dp_e: DiscussionRequired;\r\n\r\n  h_c: DiscussionRequired;\r\n  s_c: DiscussionRequired;\r\n  e_c: DiscussionRequired;\r\n  f_c: DiscussionRequired;\r\n\r\n  h_m: DiscussionRequired;\r\n  s_m: DiscussionRequired;\r\n  e_m: DiscussionRequired;\r\n  f_m: DiscussionRequired;\r\n\r\n  h_e: DiscussionRequired;\r\n  s_e: DiscussionRequired;\r\n  e_e: DiscussionRequired;\r\n  f_e: DiscussionRequired;\r\n\r\n  cb: DiscussionRequired;\r\n}\r\n\r\nexport interface DVRiskFile<CalculationType = unknown> extends RiskFileEditableFields {\r\n  cr4de_riskfilesid: string;\r\n  cr4de_hazard_id: string;\r\n\r\n  cr4de_title: string;\r\n  cr4de_risk_type: RISK_TYPE;\r\n  cr4de_risk_category: string;\r\n  cr4de_key_risk: boolean;\r\n\r\n  cr4de_label_hilp: boolean | null;\r\n  cr4de_label_cc: boolean | null;\r\n  cr4de_label_cb: boolean | null;\r\n  cr4de_label_impact: \"Human\" | \"Societal\" | \"Environmental\" | \"Financial\" | null;\r\n\r\n  cr4de_mrs_summary: string | null;\r\n  cr4de_mrs_scenario: string | null;\r\n  cr4de_mrs_disclaimer: string | null;\r\n  cr4de_mrs_probability: string | null;\r\n  cr4de_mrs_impact_h: string | null;\r\n  cr4de_mrs_impact_s: string | null;\r\n  cr4de_mrs_impact_e: string | null;\r\n  cr4de_mrs_impact_f: string | null;\r\n  cr4de_mrs_cc: string | null;\r\n\r\n  cr4de_subjective_importance: number;\r\n\r\n  cr4de_dp_quali: string | null;\r\n  cr4de_dp_quali_c: string | null;\r\n  cr4de_dp_quali_m: string | null;\r\n  cr4de_dp_quali_e: string | null;\r\n  cr4de_di_quali_h: string | null;\r\n  cr4de_di_quali_s: string | null;\r\n  cr4de_di_quali_e: string | null;\r\n  cr4de_di_quali_f: string | null;\r\n\r\n  cr4de_di_quali_h_c: string | null;\r\n  cr4de_di_quali_s_c: string | null;\r\n  cr4de_di_quali_e_c: string | null;\r\n  cr4de_di_quali_f_c: string | null;\r\n  cr4de_di_quali_h_m: string | null;\r\n  cr4de_di_quali_s_m: string | null;\r\n  cr4de_di_quali_e_m: string | null;\r\n  cr4de_di_quali_f_m: string | null;\r\n  cr4de_di_quali_h_e: string | null;\r\n  cr4de_di_quali_s_e: string | null;\r\n  cr4de_di_quali_e_e: string | null;\r\n  cr4de_di_quali_f_e: string | null;\r\n\r\n  cr4de_dp_quanti_c: string | null;\r\n  cr4de_dp_quanti_m: string | null;\r\n  cr4de_dp_quanti_e: string | null;\r\n\r\n  cr4de_di_quanti_ha_c: string | null;\r\n  cr4de_di_quanti_hb_c: string | null;\r\n  cr4de_di_quanti_hc_c: string | null;\r\n  cr4de_di_quanti_sa_c: string | null;\r\n  cr4de_di_quanti_sb_c: string | null;\r\n  cr4de_di_quanti_sc_c: string | null;\r\n  cr4de_di_quanti_sd_c: string | null;\r\n  cr4de_di_quanti_ea_c: string | null;\r\n  cr4de_di_quanti_fa_c: string | null;\r\n  cr4de_di_quanti_fb_c: string | null;\r\n\r\n  cr4de_di_quanti_ha_m: string | null;\r\n  cr4de_di_quanti_hb_m: string | null;\r\n  cr4de_di_quanti_hc_m: string | null;\r\n  cr4de_di_quanti_sa_m: string | null;\r\n  cr4de_di_quanti_sb_m: string | null;\r\n  cr4de_di_quanti_sc_m: string | null;\r\n  cr4de_di_quanti_sd_m: string | null;\r\n  cr4de_di_quanti_ea_m: string | null;\r\n  cr4de_di_quanti_fa_m: string | null;\r\n  cr4de_di_quanti_fb_m: string | null;\r\n\r\n  cr4de_di_quanti_ha_e: string | null;\r\n  cr4de_di_quanti_hb_e: string | null;\r\n  cr4de_di_quanti_hc_e: string | null;\r\n  cr4de_di_quanti_sa_e: string | null;\r\n  cr4de_di_quanti_sb_e: string | null;\r\n  cr4de_di_quanti_sc_e: string | null;\r\n  cr4de_di_quanti_sd_e: string | null;\r\n  cr4de_di_quanti_ea_e: string | null;\r\n  cr4de_di_quanti_fa_e: string | null;\r\n  cr4de_di_quanti_fb_e: string | null;\r\n\r\n  cr4de_climate_change_quali: string | null;\r\n  cr4de_climate_change_quanti_c: string | null;\r\n  cr4de_climate_change_quanti_m: string | null;\r\n  cr4de_climate_change_quanti_e: string | null;\r\n\r\n  cr4de_cross_border_impact_quali_c: string | null;\r\n  cr4de_cross_border_impact_quali_m: string | null;\r\n  cr4de_cross_border_impact_quali_e: string | null;\r\n\r\n  cr4de_validations_processed: boolean | null;\r\n  cr4de_validation_silent_procedure_until: Date | null;\r\n\r\n  cr4de_step2a_enabled: boolean | null;\r\n  cr4de_step2a_enabled_on: Date | null;\r\n  cr4de_step2b_enabled: boolean | null;\r\n  cr4de_step2b_enabled_on: Date | null;\r\n  cr4de_consensus_type: CONSENSUS_TYPE | null;\r\n  cr4de_consensus_date: Date | null;\r\n  cr4de_discussion_required: DiscussionsRequired | null;\r\n\r\n  cr4de_is_test: boolean | null;\r\n\r\n  cr4de_latest_calculation: CalculationType | null;\r\n  _cr4de_latest_calculation_value: string | null;\r\n\r\n  createdon: string;\r\n  modifiedon: string;\r\n}\r\n\r\nexport const RISK_FILE_QUANTI_FIELDS: (keyof DVRiskFile)[] = [\r\n  \"cr4de_dp_quanti_c\",\r\n  \"cr4de_dp_quanti_m\",\r\n  \"cr4de_dp_quanti_e\",\r\n\r\n  \"cr4de_di_quanti_ha_c\",\r\n  \"cr4de_di_quanti_hb_c\",\r\n  \"cr4de_di_quanti_hc_c\",\r\n  \"cr4de_di_quanti_sa_c\",\r\n  \"cr4de_di_quanti_sb_c\",\r\n  \"cr4de_di_quanti_sc_c\",\r\n  \"cr4de_di_quanti_sd_c\",\r\n  \"cr4de_di_quanti_ea_c\",\r\n  \"cr4de_di_quanti_fa_c\",\r\n  \"cr4de_di_quanti_fb_c\",\r\n\r\n  \"cr4de_di_quanti_ha_m\",\r\n  \"cr4de_di_quanti_hb_m\",\r\n  \"cr4de_di_quanti_hc_m\",\r\n  \"cr4de_di_quanti_sa_m\",\r\n  \"cr4de_di_quanti_sb_m\",\r\n  \"cr4de_di_quanti_sc_m\",\r\n  \"cr4de_di_quanti_sd_m\",\r\n  \"cr4de_di_quanti_ea_m\",\r\n  \"cr4de_di_quanti_fa_m\",\r\n  \"cr4de_di_quanti_fb_m\",\r\n\r\n  \"cr4de_di_quanti_ha_e\",\r\n  \"cr4de_di_quanti_hb_e\",\r\n  \"cr4de_di_quanti_hc_e\",\r\n  \"cr4de_di_quanti_sa_e\",\r\n  \"cr4de_di_quanti_sb_e\",\r\n  \"cr4de_di_quanti_sc_e\",\r\n  \"cr4de_di_quanti_sd_e\",\r\n  \"cr4de_di_quanti_ea_e\",\r\n  \"cr4de_di_quanti_fa_e\",\r\n  \"cr4de_di_quanti_fb_e\",\r\n\r\n  \"cr4de_climate_change_quanti_c\",\r\n  \"cr4de_climate_change_quanti_m\",\r\n  \"cr4de_climate_change_quanti_e\",\r\n];\r\n","import { CascadeCalculation, RiskCalculation } from \"../types/dataverse/DVAnalysisRun\";\r\nimport { DVRiskCascade } from \"../types/dataverse/DVRiskCascade\";\r\nimport { DVRiskFile } from \"../types/dataverse/DVRiskFile\";\r\nimport { SCENARIO_SUFFIX } from \"./scenarios\";\r\n\r\nexport type Effect = {\r\n  id: string | null;\r\n  name: string;\r\n  ha: number;\r\n  hb: number;\r\n  hc: number;\r\n  sa: number;\r\n  sb: number;\r\n  sc: number;\r\n  sd: number;\r\n  ea: number;\r\n  fa: number;\r\n  fb: number;\r\n  h: number;\r\n  s: number;\r\n  e: number;\r\n  f: number;\r\n  quali?: string | null;\r\n  quali_cause?: string | null;\r\n\r\n  quali_h?: string | null;\r\n  quali_s?: string | null;\r\n  quali_e?: string | null;\r\n  quali_f?: string | null;\r\n};\r\n\r\nexport type IMPACT_CATEGORY = \"H\" | \"S\" | \"E\" | \"F\";\r\nexport type DAMAGE_INDICATOR = \"Ha\" | \"Hb\" | \"Hc\" | \"Sa\" | \"Sb\" | \"Sc\" | \"Sd\" | \"Ea\" | \"Fa\" | \"Fb\";\r\n\r\n// in k€ = € 1 000\r\nconst scales: { [key: string]: number } = {\r\n  \"0\": 0,\r\n  \"0.5\": 5000,\r\n  \"1\": 16000,\r\n  \"1.5\": 50000,\r\n  \"2\": 160000,\r\n  \"2.5\": 500000,\r\n  \"3\": 1600000,\r\n  \"3.5\": 5000000,\r\n  \"4\": 16000000,\r\n  \"4.5\": 50000000,\r\n  \"5\": 160000000,\r\n  \"5.5\": 500000000,\r\n};\r\n\r\nexport function getAbsoluteImpact(scaleString: string | null) {\r\n  if (scaleString === null) return 0;\r\n\r\n  return 1000 * scales[scaleString.slice(2)];\r\n}\r\n\r\nexport function getImpactScaleNumber(absoluteImpact: number) {\r\n  if (absoluteImpact === 0) return \"0\";\r\n\r\n  const diffs: [string, number][] = Object.entries(scales)\r\n    .sort((a, b) => b[1] - a[1])\r\n    .map((v) => [v[0], Math.abs(Math.log(1000 * v[1]) - Math.log(absoluteImpact))]);\r\n\r\n  const minDiff = diffs.reduce((min, cur) => (min[1] >= cur[1] ? cur : min));\r\n\r\n  return minDiff[0];\r\n}\r\n\r\nexport function getImpactScale(absoluteImpact: number, scalePrefix: string) {\r\n  return `${scalePrefix}${getImpactScaleNumber(absoluteImpact)}`;\r\n}\r\n\r\nexport function getMoneyString(impactNumber: number) {\r\n  if (impactNumber < 1000000) {\r\n    return `€ ${impactNumber.toLocaleString()}`;\r\n  }\r\n  if (impactNumber < 1000000000) {\r\n    return `€ ${(Math.round(impactNumber / 10000) / 100).toLocaleString()}M`;\r\n  }\r\n  if (impactNumber < 1000000000000) {\r\n    return `€ ${(Math.round(impactNumber / 10000000) / 100).toLocaleString()}B`;\r\n  }\r\n\r\n  return `€ ${(Math.round(impactNumber / 10000000000) / 100).toLocaleString()}T`;\r\n}\r\n\r\nexport function getDirectImpact(c: RiskCalculation, rf: DVRiskFile, scenarioSuffix: SCENARIO_SUFFIX): Effect {\r\n  return {\r\n    id: null,\r\n    name: \"Direct Impact\",\r\n    ha: c[`di_Ha${scenarioSuffix}`] / c[`ti_Ha${scenarioSuffix}`],\r\n    hb: c[`di_Hb${scenarioSuffix}`] / c[`ti_Hb${scenarioSuffix}`],\r\n    hc: c[`di_Hc${scenarioSuffix}`] / c[`ti_Hc${scenarioSuffix}`],\r\n    sa: c[`di_Sa${scenarioSuffix}`] / c[`ti_Sa${scenarioSuffix}`],\r\n    sb: c[`di_Sb${scenarioSuffix}`] / c[`ti_Sb${scenarioSuffix}`],\r\n    sc: c[`di_Sc${scenarioSuffix}`] / c[`ti_Sc${scenarioSuffix}`],\r\n    sd: c[`di_Sd${scenarioSuffix}`] / c[`ti_Sd${scenarioSuffix}`],\r\n    ea: c[`di_Ea${scenarioSuffix}`] / c[`ti_Ea${scenarioSuffix}`],\r\n    fa: c[`di_Fa${scenarioSuffix}`] / c[`ti_Fa${scenarioSuffix}`],\r\n    fb: c[`di_Fb${scenarioSuffix}`] / c[`ti_Fb${scenarioSuffix}`],\r\n\r\n    h:\r\n      (c[`di_Ha${scenarioSuffix}`] + c[`di_Hb${scenarioSuffix}`] + c[`di_Hc${scenarioSuffix}`]) /\r\n      (c[`ti_Ha${scenarioSuffix}`] + c[`ti_Hb${scenarioSuffix}`] + c[`ti_Hc${scenarioSuffix}`]),\r\n    s:\r\n      (c[`di_Sa${scenarioSuffix}`] +\r\n        c[`di_Sb${scenarioSuffix}`] +\r\n        c[`di_Sc${scenarioSuffix}`] +\r\n        c[`di_Sd${scenarioSuffix}`]) /\r\n      (c[`ti_Sa${scenarioSuffix}`] +\r\n        c[`ti_Sb${scenarioSuffix}`] +\r\n        c[`ti_Sc${scenarioSuffix}`] +\r\n        c[`ti_Sd${scenarioSuffix}`]),\r\n    e: c[`di_Ea${scenarioSuffix}`] / c[`ti_Ea${scenarioSuffix}`],\r\n    f:\r\n      (c[`di_Fa${scenarioSuffix}`] + c[`di_Fb${scenarioSuffix}`]) /\r\n      (c[`ti_Fa${scenarioSuffix}`] + c[`ti_Fb${scenarioSuffix}`]),\r\n\r\n    quali_h: rf[`cr4de_di_quali_h${scenarioSuffix}`],\r\n    quali_s: rf[`cr4de_di_quali_s${scenarioSuffix}`],\r\n    quali_e: rf[`cr4de_di_quali_e${scenarioSuffix}`],\r\n    quali_f: rf[`cr4de_di_quali_f${scenarioSuffix}`],\r\n  };\r\n}\r\n\r\nexport function getIndirectImpact(\r\n  c: CascadeCalculation,\r\n  tot: RiskCalculation,\r\n  scenarioSuffix: SCENARIO_SUFFIX,\r\n  cascade?: DVRiskCascade\r\n): Effect {\r\n  return {\r\n    id: c.effect.riskId,\r\n    name: c.effect.riskTitle,\r\n    ha: c[`ii_Ha${scenarioSuffix}`] / tot[`ti_Ha${scenarioSuffix}`],\r\n    hb: c[`ii_Hb${scenarioSuffix}`] / tot[`ti_Hb${scenarioSuffix}`],\r\n    hc: c[`ii_Hc${scenarioSuffix}`] / tot[`ti_Hc${scenarioSuffix}`],\r\n    sa: c[`ii_Sa${scenarioSuffix}`] / tot[`ti_Sa${scenarioSuffix}`],\r\n    sb: c[`ii_Sb${scenarioSuffix}`] / tot[`ti_Sb${scenarioSuffix}`],\r\n    sc: c[`ii_Sc${scenarioSuffix}`] / tot[`ti_Sc${scenarioSuffix}`],\r\n    sd: c[`ii_Sd${scenarioSuffix}`] / tot[`ti_Sd${scenarioSuffix}`],\r\n    ea: c[`ii_Ea${scenarioSuffix}`] / tot[`ti_Ea${scenarioSuffix}`],\r\n    fa: c[`ii_Fa${scenarioSuffix}`] / tot[`ti_Fa${scenarioSuffix}`],\r\n    fb: c[`ii_Fb${scenarioSuffix}`] / tot[`ti_Fb${scenarioSuffix}`],\r\n\r\n    h:\r\n      (c[`ii_Ha${scenarioSuffix}`] + c[`ii_Hb${scenarioSuffix}`] + c[`ii_Hc${scenarioSuffix}`]) /\r\n      (tot[`ti_Ha${scenarioSuffix}`] + tot[`ti_Hb${scenarioSuffix}`] + tot[`ti_Hc${scenarioSuffix}`]),\r\n    s:\r\n      (c[`ii_Sa${scenarioSuffix}`] +\r\n        c[`ii_Sb${scenarioSuffix}`] +\r\n        c[`ii_Sc${scenarioSuffix}`] +\r\n        c[`ii_Sd${scenarioSuffix}`]) /\r\n      (tot[`ti_Sa${scenarioSuffix}`] +\r\n        tot[`ti_Sb${scenarioSuffix}`] +\r\n        tot[`ti_Sc${scenarioSuffix}`] +\r\n        tot[`ti_Sd${scenarioSuffix}`]),\r\n    e: c[`ii_Ea${scenarioSuffix}`] / tot[`ti_Ea${scenarioSuffix}`],\r\n    f:\r\n      (c[`ii_Fa${scenarioSuffix}`] + c[`ii_Fb${scenarioSuffix}`]) /\r\n      (tot[`ti_Fa${scenarioSuffix}`] + tot[`ti_Fb${scenarioSuffix}`]),\r\n\r\n    quali: (cascade && cascade.cr4de_quali) || \"\",\r\n    quali_cause: cascade && cascade.cr4de_quali_cause,\r\n  };\r\n}\r\n\r\nexport const getTotalImpactRelativeScale = (calculation: RiskCalculation, scenarioSuffix: SCENARIO_SUFFIX) => {\r\n  const baseImpact = 800000000;\r\n  const ti = calculation[`ti${scenarioSuffix}`];\r\n\r\n  if (ti < baseImpact) return ti / baseImpact;\r\n\r\n  return 1 + Math.log10(ti / baseImpact) / Math.log10(5);\r\n};\r\n\r\nconst rescaleImpact = (i: number) => {\r\n  // return i;\r\n  if (i < 1.5) return 0.5 * (i / 1.5);\r\n  // if (i > 3.5) return 4.5 + 0.5 * ((i - 3.5) / 1.5);\r\n  return 0.5 + (4.5 * (i - 1.5)) / 3.5;\r\n};\r\n\r\nexport const getCategoryImpact = (\r\n  calculation: RiskCalculation,\r\n  category: IMPACT_CATEGORY,\r\n  scenarioSuffix: SCENARIO_SUFFIX\r\n) => {\r\n  return (\r\n    (calculation[`ti_${category}a${scenarioSuffix}`] || 0) +\r\n    ((calculation[`ti_${category}b${scenarioSuffix}` as keyof RiskCalculation] as number) || 0) +\r\n    ((calculation[`ti_${category}c${scenarioSuffix}` as keyof RiskCalculation] as number) || 0) +\r\n    ((calculation[`ti_${category}d${scenarioSuffix}` as keyof RiskCalculation] as number) || 0)\r\n  );\r\n};\r\n\r\nexport const getCategoryImpactRelativeScale = (\r\n  calculation: RiskCalculation,\r\n  category: IMPACT_CATEGORY,\r\n  scenarioSuffix: SCENARIO_SUFFIX\r\n) => {\r\n  const totalImpact = getCategoryImpact(calculation, category, scenarioSuffix);\r\n\r\n  if (totalImpact < 15811388) {\r\n    return rescaleImpact(totalImpact / (2 * 15811388));\r\n  }\r\n  return rescaleImpact(Math.log10(Math.max(1, totalImpact) / 5) - 6);\r\n};\r\n\r\nexport const getDamageIndicatorRelativeScale = (\r\n  calculation: RiskCalculation,\r\n  di: DAMAGE_INDICATOR,\r\n  scenarioSuffix: SCENARIO_SUFFIX\r\n) => {\r\n  const totalImpact = getCategoryImpact(calculation, di[0] as IMPACT_CATEGORY, scenarioSuffix);\r\n  const diImpact = calculation[`ti_${di}${scenarioSuffix}`] || 0;\r\n\r\n  const ratio = diImpact / totalImpact;\r\n  return (\r\n    Math.round(10 * ratio * getCategoryImpactRelativeScale(calculation, di[0] as IMPACT_CATEGORY, scenarioSuffix)) / 10\r\n  );\r\n};\r\n","import { RiskCalculation } from \"../types/dataverse/DVAnalysisRun\";\r\nimport { SCENARIO_SUFFIX } from \"./scenarios\";\r\n\r\nexport type Cause = {\r\n  id: string | null;\r\n  name: string;\r\n  p: number;\r\n  quali: string | null;\r\n};\r\n\r\n// Upper bounds of interval\r\n// Return period of an event\r\nconst DPScales: { [key: string]: number } = {\r\n  \"0\": 30000,\r\n  \"1\": 3000,\r\n  \"2\": 300,\r\n  \"3\": 30,\r\n  \"4\": 3,\r\n  \"5\": 0.3,\r\n};\r\n\r\n// Upper bound of interval\r\n// Probability of at least 1 attack in the next 3 years\r\nconst MScales: { [key: string]: number } = {\r\n  \"0\": 0.01,\r\n  \"1\": 0.5,\r\n  \"2\": 0.0,\r\n  \"3\": 1,\r\n};\r\nconst CPScales: { [key: string]: number } = {\r\n  \"0\": 0,\r\n  \"0.5\": 0.001,\r\n  \"1\": 0.004,\r\n  \"1.5\": 0.01,\r\n  \"2\": 0.04,\r\n  \"2.5\": 0.1,\r\n  \"3\": 0.3,\r\n  \"3.5\": 0.5,\r\n  \"4\": 0.7,\r\n  \"4.5\": 0.9,\r\n  \"5\": 0.95,\r\n};\r\n\r\nconst logMean = (x: number, y: number) => (y - x) / (Math.log10(y) - Math.log10(x));\r\nconst mean = (x: number, y: number) => (x + y) / 2;\r\n\r\nexport function getReturnPeriod(DPScaleString: string) {\r\n  if (DPScaleString === \"DP0\") return logMean(DPScales[\"0\"], DPScales[\"0\"] * 10);\r\n\r\n  if (DPScaleString.indexOf(\".\") >= 0) {\r\n    const scaleNumber = Math.floor(parseFloat(DPScaleString.replace(\"DP\", \"\")));\r\n    return DPScales[scaleNumber];\r\n  } else {\r\n    const scaleNumber = parseInt(DPScaleString.replace(\"DP\", \"\"), 10);\r\n    const upperReturnPeriod = DPScales[scaleNumber - 1];\r\n    const lowerReturnPeriod = DPScales[scaleNumber];\r\n\r\n    return logMean(lowerReturnPeriod, upperReturnPeriod);\r\n  }\r\n}\r\n\r\nexport function get3YearLikelihood(MScaleString: string) {\r\n  if (MScaleString === \"M0\") return mean(0, MScales[\"0\"]);\r\n\r\n  if (MScaleString.indexOf(\".\") >= 0) {\r\n    const scaleNumber = Math.floor(parseFloat(MScaleString.replace(\"M\", \"\")));\r\n    return MScales[scaleNumber];\r\n  } else {\r\n    const scaleNumber = parseInt(MScaleString.replace(\"M\", \"\"), 10);\r\n    return mean(MScales[scaleNumber - 1], MScales[scaleNumber]);\r\n  }\r\n}\r\n\r\nexport function getDPDailyProbability(scaleString: string | null) {\r\n  if (scaleString === null) return 0;\r\n\r\n  // Assuming poisson distribution\r\n  return 1 - Math.exp(-1 / (getReturnPeriod(scaleString) * 365));\r\n}\r\n\r\nexport function getMDailyProbability(scaleString: string | null) {\r\n  if (scaleString === null) return 0;\r\n\r\n  // Assuming poisson distribution\r\n  return (-1 * Math.log(1 - get3YearLikelihood(scaleString))) / (3 * 365);\r\n}\r\n\r\nexport function getAbsoluteProbability(scaleString: string | null, scaleFactor: number = 1) {\r\n  if (scaleString === null) return 0;\r\n\r\n  if (scaleString.startsWith(\"DP\")) {\r\n    return getDPDailyProbability(scaleString) * scaleFactor;\r\n  } else if (scaleString.startsWith(\"CP\")) {\r\n    return CPScales[scaleString.replace(\"CP\", \"\")] * scaleFactor;\r\n  } else if (scaleString.startsWith(\"M\")) {\r\n    return getMDailyProbability(scaleString) * scaleFactor;\r\n  }\r\n\r\n  return -1;\r\n}\r\n\r\nexport function getProbabilityScaleNumber(absoluteProbability: number, scalePrefix: string) {\r\n  let scales;\r\n  if (scalePrefix === \"DP\") scales = DPScales;\r\n  else if (scalePrefix === \"DP50-\") scales = DPScales;\r\n  else if (scalePrefix === \"CP\") scales = CPScales;\r\n  else if (scalePrefix === \"M\") scales = MScales;\r\n  else return \"??\";\r\n\r\n  if (absoluteProbability === 0) return \"0\";\r\n\r\n  const diffs: [string, number][] = Object.entries(scales)\r\n    .sort((a, b) => b[1] - a[1])\r\n    .map((v) => [v[0], Math.abs(Math.log(v[1]) - Math.log(absoluteProbability))]);\r\n\r\n  const minDiff = diffs.reduce((min, cur) => (min[1] > cur[1] ? cur : min));\r\n\r\n  return minDiff[0];\r\n}\r\n\r\nexport function getProbabilityScale(absoluteProbability: number, scalePrefix: string) {\r\n  return `${scalePrefix}${getProbabilityScaleNumber(absoluteProbability, scalePrefix)}`;\r\n}\r\n\r\nexport const getPercentageProbability = (p: number) => {\r\n  return `${Math.round(p * 10000) / 100}%`;\r\n};\r\n\r\nexport const getYearlyProbability = (dailyP: number) => {\r\n  return 1 - Math.pow(1 - dailyP, 365);\r\n};\r\n\r\nconst rescaleProbability = (p: number) => {\r\n  return 5 + Math.log(p + 0.0103) / Math.log(2.5);\r\n};\r\n\r\nexport function getTotalProbabilityRelativeScale(\r\n  calculation: RiskCalculation,\r\n  scenarioSuffix: SCENARIO_SUFFIX,\r\n  tp50: boolean = false\r\n) {\r\n  return rescaleProbability(getYearlyProbability(calculation[`tp${tp50 ? \"50\" : \"\"}${scenarioSuffix}`]));\r\n}\r\n\r\nexport function getPartialProbabilityRelativeScale(\r\n  p_daily: number,\r\n  calculation: RiskCalculation,\r\n  scenarioSuffix: SCENARIO_SUFFIX,\r\n  tp50: boolean = false\r\n) {\r\n  const tp = getYearlyProbability(calculation[`tp${tp50 ? \"50\" : \"\"}${scenarioSuffix}`]);\r\n  const ratio = getYearlyProbability(p_daily) / tp;\r\n\r\n  return ratio * rescaleProbability(tp);\r\n}\r\n","export interface DirectAnalysisEditableFields {\r\n  cr4de_dp_quali_c: string | null;\r\n  cr4de_dp_quanti_c: string | null;\r\n  cr4de_dp_quali_m: string | null;\r\n  cr4de_dp_quanti_m: string | null;\r\n  cr4de_dp_quali_e: string | null;\r\n  cr4de_dp_quanti_e: string | null;\r\n\r\n  cr4de_di_quali_h_c: string | null;\r\n  cr4de_di_quanti_ha_c: string | null;\r\n  cr4de_di_quanti_hb_c: string | null;\r\n  cr4de_di_quanti_hc_c: string | null;\r\n  cr4de_di_quali_s_c: string | null;\r\n  cr4de_di_quanti_sa_c: string | null;\r\n  cr4de_di_quanti_sb_c: string | null;\r\n  cr4de_di_quanti_sc_c: string | null;\r\n  cr4de_di_quanti_sd_c: string | null;\r\n  cr4de_di_quali_e_c: string | null;\r\n  cr4de_di_quanti_ea_c: string | null;\r\n  cr4de_di_quali_f_c: string | null;\r\n  cr4de_di_quanti_fa_c: string | null;\r\n  cr4de_di_quanti_fb_c: string | null;\r\n\r\n  cr4de_di_quali_h_m: string | null;\r\n  cr4de_di_quanti_ha_m: string | null;\r\n  cr4de_di_quanti_hb_m: string | null;\r\n  cr4de_di_quanti_hc_m: string | null;\r\n  cr4de_di_quali_s_m: string | null;\r\n  cr4de_di_quanti_sa_m: string | null;\r\n  cr4de_di_quanti_sb_m: string | null;\r\n  cr4de_di_quanti_sc_m: string | null;\r\n  cr4de_di_quanti_sd_m: string | null;\r\n  cr4de_di_quali_e_m: string | null;\r\n  cr4de_di_quanti_ea_m: string | null;\r\n  cr4de_di_quali_f_m: string | null;\r\n  cr4de_di_quanti_fa_m: string | null;\r\n  cr4de_di_quanti_fb_m: string | null;\r\n\r\n  cr4de_di_quali_h_e: string | null;\r\n  cr4de_di_quanti_ha_e: string | null;\r\n  cr4de_di_quanti_hb_e: string | null;\r\n  cr4de_di_quanti_hc_e: string | null;\r\n  cr4de_di_quali_s_e: string | null;\r\n  cr4de_di_quanti_sa_e: string | null;\r\n  cr4de_di_quanti_sb_e: string | null;\r\n  cr4de_di_quanti_sc_e: string | null;\r\n  cr4de_di_quanti_sd_e: string | null;\r\n  cr4de_di_quali_e_e: string | null;\r\n  cr4de_di_quanti_ea_e: string | null;\r\n  cr4de_di_quali_f_e: string | null;\r\n  cr4de_di_quanti_fa_e: string | null;\r\n  cr4de_di_quanti_fb_e: string | null;\r\n\r\n  cr4de_cross_border_impact_quali_c: string | null;\r\n  cr4de_cross_border_impact_quali_m: string | null;\r\n  cr4de_cross_border_impact_quali_e: string | null;\r\n\r\n  cr4de_dp50_quali: string | null;\r\n  cr4de_dp50_quanti_c: string | null;\r\n  cr4de_dp50_quanti_m: string | null;\r\n  cr4de_dp50_quanti_e: string | null;\r\n}\r\n\r\nexport interface DVDirectAnalysis<RiskFileType = unknown, ExpertType = unknown> extends DirectAnalysisEditableFields {\r\n  cr4de_bnradirectanalysisid: string;\r\n\r\n  cr4de_expert: ExpertType;\r\n  _cr4de_expert_value: string;\r\n  cr4de_risk_file: RiskFileType;\r\n  _cr4de_risk_file_value: string;\r\n\r\n  cr4de_quality: FieldQuality | null;\r\n\r\n  createdon: Date;\r\n  modifiedon: Date;\r\n}\r\n\r\nexport const DIRECT_ANALYSIS_EDITABLE_FIELDS_MANMADE: (keyof DirectAnalysisEditableFields)[] = [\r\n  \"cr4de_dp_quali_c\",\r\n  \"cr4de_dp_quanti_c\",\r\n  \"cr4de_dp_quali_m\",\r\n  \"cr4de_dp_quanti_m\",\r\n  \"cr4de_dp_quali_e\",\r\n  \"cr4de_dp_quanti_e\",\r\n];\r\n\r\nexport const DIRECT_ANALYSIS_EDITABLE_FIELDS: (keyof DirectAnalysisEditableFields)[] = [\r\n  \"cr4de_dp_quali_c\",\r\n  \"cr4de_dp_quanti_c\",\r\n  \"cr4de_dp_quali_m\",\r\n  \"cr4de_dp_quanti_m\",\r\n  \"cr4de_dp_quali_e\",\r\n  \"cr4de_dp_quanti_e\",\r\n\r\n  \"cr4de_di_quali_h_c\",\r\n  \"cr4de_di_quanti_ha_c\",\r\n  \"cr4de_di_quanti_hb_c\",\r\n  \"cr4de_di_quanti_hc_c\",\r\n  \"cr4de_di_quali_s_c\",\r\n  \"cr4de_di_quanti_sa_c\",\r\n  \"cr4de_di_quanti_sb_c\",\r\n  \"cr4de_di_quanti_sc_c\",\r\n  \"cr4de_di_quanti_sd_c\",\r\n  \"cr4de_di_quali_e_c\",\r\n  \"cr4de_di_quanti_ea_c\",\r\n  \"cr4de_di_quali_f_c\",\r\n  \"cr4de_di_quanti_fa_c\",\r\n  \"cr4de_di_quanti_fb_c\",\r\n\r\n  \"cr4de_di_quali_h_m\",\r\n  \"cr4de_di_quanti_ha_m\",\r\n  \"cr4de_di_quanti_hb_m\",\r\n  \"cr4de_di_quanti_hc_m\",\r\n  \"cr4de_di_quali_s_m\",\r\n  \"cr4de_di_quanti_sa_m\",\r\n  \"cr4de_di_quanti_sb_m\",\r\n  \"cr4de_di_quanti_sc_m\",\r\n  \"cr4de_di_quanti_sd_m\",\r\n  \"cr4de_di_quali_e_m\",\r\n  \"cr4de_di_quanti_ea_m\",\r\n  \"cr4de_di_quali_f_m\",\r\n  \"cr4de_di_quanti_fa_m\",\r\n  \"cr4de_di_quanti_fb_m\",\r\n\r\n  \"cr4de_di_quali_h_e\",\r\n  \"cr4de_di_quanti_ha_e\",\r\n  \"cr4de_di_quanti_hb_e\",\r\n  \"cr4de_di_quanti_hc_e\",\r\n  \"cr4de_di_quali_s_e\",\r\n  \"cr4de_di_quanti_sa_e\",\r\n  \"cr4de_di_quanti_sb_e\",\r\n  \"cr4de_di_quanti_sc_e\",\r\n  \"cr4de_di_quanti_sd_e\",\r\n  \"cr4de_di_quali_e_e\",\r\n  \"cr4de_di_quanti_ea_e\",\r\n  \"cr4de_di_quali_f_e\",\r\n  \"cr4de_di_quanti_fa_e\",\r\n  \"cr4de_di_quanti_fb_e\",\r\n\r\n  \"cr4de_cross_border_impact_quali_c\",\r\n  \"cr4de_cross_border_impact_quali_m\",\r\n  \"cr4de_cross_border_impact_quali_e\",\r\n\r\n  \"cr4de_dp50_quanti_c\",\r\n  \"cr4de_dp50_quanti_m\",\r\n  \"cr4de_dp50_quanti_e\",\r\n];\r\n\r\nexport const DIRECT_ANALYSIS_QUANTI_FIELDS = DIRECT_ANALYSIS_EDITABLE_FIELDS.filter((f) => f.indexOf(\"quanti\") > 0);\r\n\r\nexport interface FieldQuality {\r\n  dp_c: number;\r\n  dp_m: number;\r\n  dp_e: number;\r\n\r\n  h_c: number;\r\n  s_c: number;\r\n  e_c: number;\r\n  f_c: number;\r\n\r\n  h_m: number;\r\n  s_m: number;\r\n  e_m: number;\r\n  f_m: number;\r\n\r\n  h_e: number;\r\n  s_e: number;\r\n  e_e: number;\r\n  f_e: number;\r\n\r\n  cb: number;\r\n  cc: number;\r\n}\r\n","import { CASCADE_ANALYSIS_QUANTI_FIELDS, DVCascadeAnalysis } from \"../types/dataverse/DVCascadeAnalysis\";\r\nimport { DVContact } from \"../types/dataverse/DVContact\";\r\nimport {\r\n  DIRECT_ANALYSIS_EDITABLE_FIELDS,\r\n  DIRECT_ANALYSIS_EDITABLE_FIELDS_MANMADE,\r\n  DIRECT_ANALYSIS_QUANTI_FIELDS,\r\n  DVDirectAnalysis,\r\n  FieldQuality,\r\n} from \"../types/dataverse/DVDirectAnalysis\";\r\nimport { DVParticipation } from \"../types/dataverse/DVParticipation\";\r\nimport { DVRiskCascade } from \"../types/dataverse/DVRiskCascade\";\r\nimport { DVRiskFile, RISK_TYPE } from \"../types/dataverse/DVRiskFile\";\r\nimport { SmallRisk } from \"../types/dataverse/DVSmallRisk\";\r\nimport { getProbabilityScale } from \"./Probability\";\r\nimport { SCENARIOS, SCENARIO_PARAMS } from \"./scenarios\";\r\n\r\ninterface DIRECT_ANALYSIS_SECTION {\r\n  name: string;\r\n  label: string;\r\n}\r\n\r\nexport interface STATS {\r\n  min: number;\r\n  minLabel: string;\r\n  max: number;\r\n  maxLabel: string;\r\n  avg: number;\r\n  avgLabel: string;\r\n  std: number;\r\n}\r\n\r\nexport enum PARAMETER {\r\n  DP,\r\n  DP2050,\r\n  H,\r\n  S,\r\n  E,\r\n  F,\r\n  CB,\r\n}\r\n\r\nexport const DIRECT_ANALYSIS_SECTIONS_STANDARD: { [key in PARAMETER]: DIRECT_ANALYSIS_SECTION } = {\r\n  [PARAMETER.DP]: {\r\n    name: \"dp\",\r\n    label: \"Direct Probability\",\r\n  },\r\n  [PARAMETER.DP2050]: {\r\n    name: \"dp50\",\r\n    label: \"Direct Probability 2050\",\r\n  },\r\n  [PARAMETER.H]: {\r\n    name: \"h\",\r\n    label: \"Direct Human Impact\",\r\n  },\r\n  [PARAMETER.S]: {\r\n    name: \"s\",\r\n    label: \"Direct Societal Impact\",\r\n  },\r\n  [PARAMETER.E]: {\r\n    name: \"e\",\r\n    label: \"Direct Environmental Impact\",\r\n  },\r\n  [PARAMETER.F]: {\r\n    name: \"f\",\r\n    label: \"Direct Financial Impact\",\r\n  },\r\n  [PARAMETER.CB]: {\r\n    name: \"cb\",\r\n    label: \"Cross-border Effects\",\r\n  },\r\n};\r\n\r\nexport const DIRECT_ANALYSIS_SECTIONS_MANMADE: { [PARAMETER.DP]: DIRECT_ANALYSIS_SECTION } = {\r\n  [PARAMETER.DP]: {\r\n    name: \"dp\",\r\n    label: \"Motivation\",\r\n  },\r\n};\r\n\r\nexport const getDASections = (riskFile: DVRiskFile) => {\r\n  if (riskFile.cr4de_risk_type === RISK_TYPE.STANDARD) {\r\n    return [PARAMETER.DP, PARAMETER.H, PARAMETER.S, PARAMETER.E, PARAMETER.F, PARAMETER.CB].map(\r\n      (p) => DIRECT_ANALYSIS_SECTIONS_STANDARD[p]\r\n    ) as DIRECT_ANALYSIS_SECTION[];\r\n  }\r\n  if (riskFile.cr4de_risk_type === RISK_TYPE.MANMADE) {\r\n    return [DIRECT_ANALYSIS_SECTIONS_MANMADE[PARAMETER.DP]] as DIRECT_ANALYSIS_SECTION[];\r\n  }\r\n  return [] as DIRECT_ANALYSIS_SECTION[];\r\n};\r\n\r\nfunction getQuantiNumbers(quantiInput: (string | null)[]) {\r\n  const good = quantiInput.filter((i) => i !== null) as string[];\r\n\r\n  if (good.length <= 0) return null;\r\n\r\n  const prefix = good[0].slice(0, good[0].search(/\\d/));\r\n\r\n  return {\r\n    prefix,\r\n    numbers: good.map((i) => parseInt(i.replace(prefix, \"\"), 10)),\r\n  };\r\n}\r\n\r\nexport function getQuantiNumber(quantiString: string) {\r\n  const prefix = quantiString.slice(0, quantiString.search(/\\d/));\r\n\r\n  return {\r\n    prefix,\r\n    number: parseFloat(quantiString.replace(prefix, \"\")),\r\n  };\r\n}\r\n\r\nexport function avg(n: number[], weights?: number[]) {\r\n  const totalWeight = weights ? weights.reduce((tot, cur) => tot + cur) : n.length;\r\n\r\n  return (\r\n    Math.round(\r\n      2 *\r\n        n.reduce((tot, cur, i) => {\r\n          if (weights) return tot + (cur * weights[i]) / totalWeight;\r\n          return tot + cur / totalWeight;\r\n        }, 0)\r\n    ) / 2\r\n  );\r\n}\r\n\r\nexport function std(n: number[], weights?: number[]) {\r\n  const average = avg(n, weights);\r\n\r\n  const totalWeight = weights ? weights.reduce((tot, cur) => tot + cur) : n.length;\r\n\r\n  return (\r\n    Math.round(\r\n      10 *\r\n        Math.sqrt(\r\n          n.reduce((varTot, cur, i) => {\r\n            if (weights) {\r\n              return varTot + Math.pow(weights[i] * (cur - average), 2);\r\n            }\r\n\r\n            return varTot + Math.pow(cur - average, 2);\r\n          }, 0) / totalWeight\r\n        )\r\n    ) / 10.0\r\n  );\r\n}\r\n\r\nexport function getAverage(quantiInput: (string | null)[], weights?: number[]) {\r\n  const n = getQuantiNumbers(quantiInput);\r\n\r\n  if (!n) return null;\r\n\r\n  return `${n.prefix}${avg(n.numbers, weights)}`;\r\n}\r\n\r\nexport function getStd(quantiInput: (string | null)[], weights?: number[]) {\r\n  const n = getQuantiNumbers(quantiInput);\r\n\r\n  if (!n) return null;\r\n\r\n  return std(n.numbers, weights);\r\n}\r\n\r\nexport function getStats(quantiInput: (string | null)[], weights?: number[]): STATS | null {\r\n  const n = getQuantiNumbers(quantiInput);\r\n\r\n  if (!n)\r\n    return {\r\n      min: 0,\r\n      max: 0,\r\n      avg: 0,\r\n      std: 0,\r\n      minLabel: \"\",\r\n      maxLabel: \"\",\r\n      avgLabel: \"\",\r\n    };\r\n\r\n  const values = {\r\n    min: Math.min(...n.numbers),\r\n    max: Math.max(...n.numbers),\r\n    avg: avg(n.numbers, weights),\r\n    std: std(n.numbers, weights),\r\n  };\r\n\r\n  return {\r\n    ...values,\r\n    minLabel: `${n.prefix}${values.min}`,\r\n    maxLabel: `${n.prefix}${values.max}`,\r\n    avgLabel: `${n.prefix}${values.avg}`,\r\n  };\r\n}\r\n\r\nexport function getDASpread(directAnalyses: DVDirectAnalysis[], fieldName: keyof DVDirectAnalysis) {\r\n  return directAnalyses.reduce(\r\n    (minMax, cur) => {\r\n      if (cur[fieldName] === null) return minMax;\r\n\r\n      const num = getQuantiNumber(cur[fieldName] as string).number;\r\n\r\n      return [minMax[0] <= num ? minMax[0] : num, minMax[1] >= num ? minMax[1] : num];\r\n    },\r\n    [6, 0]\r\n  );\r\n}\r\n\r\nexport function getDADivergence(\r\n  directAnalyses: DVDirectAnalysis[],\r\n  scenario: SCENARIOS,\r\n  section: DIRECT_ANALYSIS_SECTION\r\n) {\r\n  const fieldNames = getQuantiFieldNames(scenario, section);\r\n\r\n  const stds = fieldNames.map((f) => {\r\n    const stats = getStats(directAnalyses.map((da) => da[f] as string | null));\r\n\r\n    if (stats === null) return null;\r\n\r\n    return stats.std;\r\n  });\r\n\r\n  return Math.round((100 * avg(stds.filter((s) => s !== null) as number[])) / (section.name === \"dp\" ? 5 : 6)) / 100;\r\n}\r\n\r\nexport function getCADivergence(cascadeAnalyses: DVCascadeAnalysis[]) {\r\n  const stds = [\"c2c\", \"c2m\", \"c2e\", \"m2c\", \"m2m\", \"m2e\", \"e2c\", \"e2m\", \"e2e\"].map((f) => {\r\n    return getStd(cascadeAnalyses.map((ca) => ca[`cr4de_${f}` as keyof DVCascadeAnalysis] as string | null));\r\n  });\r\n\r\n  return Math.round((100 * avg(stds.filter((s) => s !== null) as number[])) / 6) / 100;\r\n}\r\n\r\nexport const getQualiFieldName = (scenario: SCENARIOS, parameter: DIRECT_ANALYSIS_SECTION): keyof DVDirectAnalysis => {\r\n  if (parameter.name === \"dp\") {\r\n    return `cr4de_dp_quali_${SCENARIO_PARAMS[scenario].prefix}` as keyof DVDirectAnalysis;\r\n  }\r\n\r\n  if (parameter.name === \"cb\") {\r\n    return `cr4de_cross_border_impact_quali_${SCENARIO_PARAMS[scenario].prefix}` as keyof DVDirectAnalysis;\r\n  }\r\n\r\n  return `cr4de_di_quali_${parameter.name}_${SCENARIO_PARAMS[scenario].prefix}` as keyof DVDirectAnalysis;\r\n};\r\n\r\nexport const getQuantiFieldNames = (\r\n  scenario: SCENARIOS,\r\n  parameter: DIRECT_ANALYSIS_SECTION\r\n): (keyof DVDirectAnalysis)[] => {\r\n  if (parameter.name === \"dp\") {\r\n    return [`cr4de_dp_quanti_${SCENARIO_PARAMS[scenario].prefix}` as keyof DVDirectAnalysis];\r\n  }\r\n\r\n  if (parameter.name === \"dp50\") {\r\n    return [`cr4de_dp50_quanti_${SCENARIO_PARAMS[scenario].prefix}` as keyof DVDirectAnalysis];\r\n  }\r\n\r\n  if (parameter.name === \"cb\") {\r\n    return [];\r\n  }\r\n\r\n  return DIRECT_ANALYSIS_QUANTI_FIELDS.filter((f) =>\r\n    f.match(new RegExp(`cr4de_di_quanti_${parameter.name}.{1}_${SCENARIO_PARAMS[scenario].prefix}`, \"g\"))\r\n  );\r\n};\r\n\r\nexport const quantiLabels = {};\r\n\r\nexport const getQuantiLabel = (\r\n  fieldName: keyof DVDirectAnalysis,\r\n  rfContainer: DVRiskFile | DVDirectAnalysis<DVRiskFile>\r\n) => {\r\n  if (fieldName.indexOf(\"_dp_\") >= 0) {\r\n    if ((rfContainer as DVDirectAnalysis<DVRiskFile>).cr4de_risk_file) {\r\n      if ((rfContainer as DVDirectAnalysis<DVRiskFile>).cr4de_risk_file.cr4de_risk_type === RISK_TYPE.STANDARD)\r\n        return \"Direct probability\";\r\n    } else {\r\n      if ((rfContainer as DVRiskFile).cr4de_risk_type === RISK_TYPE.STANDARD) return \"Direct probability\";\r\n    }\r\n    return \"Motivation\";\r\n  } else if (fieldName.indexOf(\"_climate_change_\") >= 0) {\r\n    if (fieldName.endsWith(\"_c\")) return \"Direct probability in 2050 - Considerable scenario\";\r\n    if (fieldName.endsWith(\"_m\")) return \"Direct probability in 2050 - Major scenario\";\r\n    if (fieldName.endsWith(\"_e\")) return \"Direct probability in 2050 - Extreme scenario\";\r\n  }\r\n\r\n  return {\r\n    ha: \"Fatalities\",\r\n    hb: \"Injured / sick people\",\r\n    hc: \"People in need of assistance\",\r\n    sa: \"Supply shortfalls and unmet human needs\",\r\n    sb: \"Diminished public order and domestic security\",\r\n    sc: \"Damage to the reputation of Belgium\",\r\n    sd: \"Loss of confidence in or functioning of the state and/or its values\",\r\n    ea: \"Damaged ecosystems\",\r\n    fa: \"Financial asset damages\",\r\n    fb: \"Reduction of economic performance\",\r\n  }[fieldName.replace(\"cr4de_di_quanti_\", \"\").slice(0, 2)];\r\n};\r\n\r\nfunction getAveragesForScenarios(\r\n  parameter: string,\r\n  field: string,\r\n  directAnalyses: DVDirectAnalysis[],\r\n  useWeights: Boolean = true\r\n) {\r\n  const daField = field.indexOf(\"climate_change\") >= 0 ? \"cr4de_dp50_quanti\" : field;\r\n\r\n  return {\r\n    [`${field}_c`]: getAverage(\r\n      directAnalyses.map((da) => da[`${daField}_c` as keyof DVDirectAnalysis]) as string[],\r\n      useWeights\r\n        ? directAnalyses.map(\r\n            (da) => (da.cr4de_quality && da.cr4de_quality[`${parameter}_c` as keyof FieldQuality]) || 2.5\r\n          )\r\n        : undefined\r\n    ),\r\n    [`${field}_m`]: getAverage(\r\n      directAnalyses.map((da) => da[`${daField}_m` as keyof DVDirectAnalysis]) as string[],\r\n      useWeights\r\n        ? directAnalyses.map(\r\n            (da) => (da.cr4de_quality && da.cr4de_quality[`${parameter}_m` as keyof FieldQuality]) || 2.5\r\n          )\r\n        : undefined\r\n    ),\r\n    [`${field}_e`]: getAverage(\r\n      directAnalyses.map((da) => da[`${daField}_e` as keyof DVDirectAnalysis]) as string[],\r\n      useWeights\r\n        ? directAnalyses.map(\r\n            (da) => (da.cr4de_quality && da.cr4de_quality[`${parameter}_e` as keyof FieldQuality]) || 2.5\r\n          )\r\n        : undefined\r\n    ),\r\n  };\r\n}\r\nexport function getConsensusRiskFile(directAnalyses: DVDirectAnalysis[], useWeights: Boolean = true) {\r\n  return {\r\n    ...getAveragesForScenarios(\"dp\", \"cr4de_dp_quanti\", directAnalyses, useWeights),\r\n    ...getAveragesForScenarios(\"h\", \"cr4de_di_quanti_ha\", directAnalyses, useWeights),\r\n    ...getAveragesForScenarios(\"h\", \"cr4de_di_quanti_hb\", directAnalyses, useWeights),\r\n    ...getAveragesForScenarios(\"h\", \"cr4de_di_quanti_hc\", directAnalyses, useWeights),\r\n    ...getAveragesForScenarios(\"s\", \"cr4de_di_quanti_sa\", directAnalyses, useWeights),\r\n    ...getAveragesForScenarios(\"s\", \"cr4de_di_quanti_sb\", directAnalyses, useWeights),\r\n    ...getAveragesForScenarios(\"s\", \"cr4de_di_quanti_sc\", directAnalyses, useWeights),\r\n    ...getAveragesForScenarios(\"s\", \"cr4de_di_quanti_sd\", directAnalyses, useWeights),\r\n    ...getAveragesForScenarios(\"e\", \"cr4de_di_quanti_ea\", directAnalyses, useWeights),\r\n    ...getAveragesForScenarios(\"f\", \"cr4de_di_quanti_fa\", directAnalyses, useWeights),\r\n    ...getAveragesForScenarios(\"f\", \"cr4de_di_quanti_fb\", directAnalyses, useWeights),\r\n    ...getAveragesForScenarios(\r\n      \"cc\",\r\n      \"cr4de_climate_change_quanti\",\r\n      directAnalyses.filter((da) => da.cr4de_dp50_quanti_c !== null),\r\n      useWeights\r\n    ),\r\n  };\r\n}\r\nexport function getConsensusCascade(cascadeAnalyses: DVCascadeAnalysis[], isCause = false, useWeights: Boolean = true) {\r\n  const c: any = {};\r\n\r\n  for (let field of CASCADE_ANALYSIS_QUANTI_FIELDS) {\r\n    c[`${field}${isCause ? \"_cause\" : \"\"}`] = getAverage(\r\n      cascadeAnalyses.map((ca) => ca[field] as string),\r\n      useWeights ? cascadeAnalyses.map((ca) => ca.cr4de_quality || 2.5) : undefined\r\n    );\r\n  }\r\n\r\n  return c;\r\n}\r\n\r\nexport const getCompletedDirectAnalyses = (\r\n  riskFile: DVRiskFile | null,\r\n  participants: DVParticipation[],\r\n  directAnalyses: DVDirectAnalysis<unknown, DVContact>[]\r\n) => {\r\n  return directAnalyses.filter((da) => {\r\n    const participant = participants.find((p) => p._cr4de_contact_value === da._cr4de_expert_value);\r\n\r\n    if (!participant) return false;\r\n    if (!participant.cr4de_direct_analysis_finished) return false;\r\n\r\n    return true;\r\n  });\r\n};\r\n\r\nexport const getCompletedCascadeAnalyses = (\r\n  riskFile: DVRiskFile,\r\n  participants: DVParticipation[],\r\n  cascades: DVRiskCascade<SmallRisk>[],\r\n  directAnalyses: DVDirectAnalysis<unknown, DVContact>[] | null,\r\n  cascadeAnalyses: DVCascadeAnalysis<unknown, unknown, DVContact>[]\r\n) => {\r\n  return cascadeAnalyses.filter((ca) => {\r\n    if (\r\n      !participants.some(\r\n        (pa) => pa._cr4de_contact_value === ca._cr4de_expert_value && pa.cr4de_cascade_analysis_finished\r\n      )\r\n    ) {\r\n      return false;\r\n    }\r\n\r\n    const cascade = cascades.find((c) => ca._cr4de_cascade_value === c.cr4de_bnrariskcascadeid);\r\n\r\n    if (!cascade) {\r\n      return false;\r\n    }\r\n\r\n    if (cascade.cr4de_cause_hazard.cr4de_risk_type !== RISK_TYPE.EMERGING) {\r\n      const ret = !CASCADE_ANALYSIS_QUANTI_FIELDS.some((f) => ca[f] === null);\r\n      return ret;\r\n    }\r\n\r\n    if (riskFile.cr4de_title.indexOf(\"Climate\") < 0 && cascade.cr4de_cause_hazard.cr4de_title.indexOf(\"Climate\") >= 0) {\r\n      const d = directAnalyses?.find((da) => da._cr4de_expert_value === ca._cr4de_expert_value);\r\n\r\n      return (\r\n        d &&\r\n        d.cr4de_dp50_quanti_c !== null &&\r\n        d.cr4de_dp50_quanti_m !== null &&\r\n        d.cr4de_dp50_quanti_e !== null &&\r\n        d.cr4de_dp50_quali !== null\r\n      );\r\n    }\r\n\r\n    return ca.cr4de_quali_cascade !== null;\r\n  });\r\n};\r\n","import {\r\n  CascadeCalculation,\r\n  Quality,\r\n  RiskCalculation,\r\n  RiskCalculationKnownFields,\r\n} from \"../../types/dataverse/DVAnalysisRun\";\r\nimport { DVCascadeAnalysis } from \"../../types/dataverse/DVCascadeAnalysis\";\r\nimport { DVContact } from \"../../types/dataverse/DVContact\";\r\nimport { DVDirectAnalysis, FieldQuality } from \"../../types/dataverse/DVDirectAnalysis\";\r\nimport { DVParticipation } from \"../../types/dataverse/DVParticipation\";\r\nimport { DVRiskCascade } from \"../../types/dataverse/DVRiskCascade\";\r\nimport { DVRiskFile, RISK_TYPE } from \"../../types/dataverse/DVRiskFile\";\r\nimport { SmallRisk } from \"../../types/dataverse/DVSmallRisk\";\r\nimport { getAbsoluteImpact } from \"../Impact\";\r\nimport { getAbsoluteProbability, getDPDailyProbability } from \"../Probability\";\r\nimport { getAverage, getConsensusRiskFile as getConsensusRiskFileAverage } from \"../inputProcessing\";\r\n\r\nconst SC_FACTOR = 1 / 10;\r\nconst SD_FACTOR = 1 / 10;\r\nconst EA_FACTOR = 1 / 10;\r\nconst METEORITE_DP_FACTOR = 1 / 100;\r\nconst INFO_OPS_CP_FACTOR = 1 / 10;\r\nconst FOOD_SUPPLY_FACTOR = 1 / 10;\r\nconst IAC_FACTOR = 1 / 10;\r\nconst ATTACK_FACTOR = 1 / 10;\r\n\r\ninterface Metrics {\r\n  consensus: number;\r\n  average: number;\r\n  missing: number;\r\n  total: number;\r\n}\r\n\r\nconst getAveragesForScenarios = (\r\n  name: string,\r\n  parameter: string,\r\n  field: string,\r\n  directAnalyses: DVDirectAnalysis[],\r\n  absoluteValueGetter: (strValue: string | null) => number\r\n) => {\r\n  const daField = field.indexOf(\"climate_change\") >= 0 ? \"cr4de_dp50_quanti\" : field;\r\n\r\n  const factor = daField === \"di_Sc\" ? SC_FACTOR : 1;\r\n\r\n  return {\r\n    [`${name}_c`]:\r\n      absoluteValueGetter(\r\n        getAverage(\r\n          directAnalyses.map((da) => da[`${daField}_c` as keyof DVDirectAnalysis]) as string[],\r\n          directAnalyses.map(\r\n            (da) => (da.cr4de_quality && da.cr4de_quality[`${parameter}_c` as keyof FieldQuality]) || 2.5\r\n          )\r\n        )\r\n      ) * factor,\r\n    [`${name}_m`]:\r\n      absoluteValueGetter(\r\n        getAverage(\r\n          directAnalyses.map((da) => da[`${daField}_m` as keyof DVDirectAnalysis]) as string[],\r\n          directAnalyses.map(\r\n            (da) => (da.cr4de_quality && da.cr4de_quality[`${parameter}_m` as keyof FieldQuality]) || 2.5\r\n          )\r\n        )\r\n      ) * factor,\r\n    [`${name}_e`]:\r\n      absoluteValueGetter(\r\n        getAverage(\r\n          directAnalyses.map((da) => da[`${daField}_e` as keyof DVDirectAnalysis]) as string[],\r\n          directAnalyses.map(\r\n            (da) => (da.cr4de_quality && da.cr4de_quality[`${parameter}_e` as keyof FieldQuality]) || 2.5\r\n          )\r\n        )\r\n      ) * factor,\r\n  };\r\n};\r\n\r\nconst getConsensusRiskFile = (\r\n  riskFile: DVRiskFile,\r\n  participations: DVParticipation[],\r\n  directAnalyses: DVDirectAnalysis<unknown, DVContact>[] | undefined\r\n): RiskCalculationKnownFields => {\r\n  const goodDAs = directAnalyses\r\n    ? directAnalyses.filter((da) =>\r\n        participations.some(\r\n          (p) =>\r\n            p._cr4de_contact_value === da.cr4de_expert.contactid &&\r\n            p.cr4de_role === \"expert\" &&\r\n            p.cr4de_direct_analysis_finished\r\n        )\r\n      )\r\n    : [];\r\n\r\n  const scaleFactor = riskFile.cr4de_title.indexOf(\"International Armed\") >= 0 ? IAC_FACTOR : 1;\r\n  const DPScaleFactor = riskFile.cr4de_title.indexOf(\"Meteorite\") >= 0 ? METEORITE_DP_FACTOR : 1;\r\n  const EaScaleFactor = EA_FACTOR;\r\n  const ExtremeFactor = riskFile.cr4de_title.indexOf(\"food supply\") >= 0 ? FOOD_SUPPLY_FACTOR : 1;\r\n\r\n  if (\r\n    (riskFile.cr4de_consensus_date && new Date(riskFile.cr4de_consensus_date) <= new Date()) ||\r\n    riskFile.cr4de_risk_type === RISK_TYPE.EMERGING\r\n  )\r\n    return {\r\n      quality: Quality.CONSENSUS,\r\n      reliability: goodDAs.length,\r\n      dp_c: getAbsoluteProbability(riskFile.cr4de_dp_quanti_c, DPScaleFactor),\r\n      dp_m: getAbsoluteProbability(riskFile.cr4de_dp_quanti_m, DPScaleFactor),\r\n      dp_e: getAbsoluteProbability(riskFile.cr4de_dp_quanti_e, DPScaleFactor),\r\n\r\n      di_Ha_c: getAbsoluteImpact(riskFile.cr4de_di_quanti_ha_c) * scaleFactor,\r\n      di_Hb_c: getAbsoluteImpact(riskFile.cr4de_di_quanti_hb_c) * scaleFactor,\r\n      di_Hc_c: getAbsoluteImpact(riskFile.cr4de_di_quanti_hc_c) * scaleFactor,\r\n      di_Sa_c: getAbsoluteImpact(riskFile.cr4de_di_quanti_sa_c) * scaleFactor,\r\n      di_Sb_c: getAbsoluteImpact(riskFile.cr4de_di_quanti_sb_c) * scaleFactor,\r\n      di_Sc_c: getAbsoluteImpact(riskFile.cr4de_di_quanti_sc_c) * scaleFactor * SC_FACTOR,\r\n      di_Sd_c: getAbsoluteImpact(riskFile.cr4de_di_quanti_sd_c) * scaleFactor * SD_FACTOR,\r\n      di_Ea_c: getAbsoluteImpact(riskFile.cr4de_di_quanti_ea_c) * scaleFactor * EaScaleFactor,\r\n      di_Fa_c: getAbsoluteImpact(riskFile.cr4de_di_quanti_fa_c) * scaleFactor,\r\n      di_Fb_c: getAbsoluteImpact(riskFile.cr4de_di_quanti_fb_c) * scaleFactor,\r\n\r\n      di_Ha_m: getAbsoluteImpact(riskFile.cr4de_di_quanti_ha_m) * scaleFactor,\r\n      di_Hb_m: getAbsoluteImpact(riskFile.cr4de_di_quanti_hb_m) * scaleFactor,\r\n      di_Hc_m: getAbsoluteImpact(riskFile.cr4de_di_quanti_hc_m) * scaleFactor,\r\n      di_Sa_m: getAbsoluteImpact(riskFile.cr4de_di_quanti_sa_m) * scaleFactor,\r\n      di_Sb_m: getAbsoluteImpact(riskFile.cr4de_di_quanti_sb_m) * scaleFactor,\r\n      di_Sc_m: getAbsoluteImpact(riskFile.cr4de_di_quanti_sc_m) * scaleFactor * SC_FACTOR,\r\n      di_Sd_m: getAbsoluteImpact(riskFile.cr4de_di_quanti_sd_m) * scaleFactor * SD_FACTOR,\r\n      di_Ea_m: getAbsoluteImpact(riskFile.cr4de_di_quanti_ea_m) * scaleFactor * EaScaleFactor,\r\n      di_Fa_m: getAbsoluteImpact(riskFile.cr4de_di_quanti_fa_m) * scaleFactor,\r\n      di_Fb_m: getAbsoluteImpact(riskFile.cr4de_di_quanti_fb_m) * scaleFactor,\r\n\r\n      di_Ha_e: getAbsoluteImpact(riskFile.cr4de_di_quanti_ha_e) * scaleFactor * ExtremeFactor,\r\n      di_Hb_e: getAbsoluteImpact(riskFile.cr4de_di_quanti_hb_e) * scaleFactor * ExtremeFactor,\r\n      di_Hc_e: getAbsoluteImpact(riskFile.cr4de_di_quanti_hc_e) * scaleFactor * ExtremeFactor,\r\n      di_Sa_e: getAbsoluteImpact(riskFile.cr4de_di_quanti_sa_e) * scaleFactor * ExtremeFactor,\r\n      di_Sb_e: getAbsoluteImpact(riskFile.cr4de_di_quanti_sb_e) * scaleFactor * ExtremeFactor,\r\n      di_Sc_e: getAbsoluteImpact(riskFile.cr4de_di_quanti_sc_e) * scaleFactor * SC_FACTOR * ExtremeFactor,\r\n      di_Sd_e: getAbsoluteImpact(riskFile.cr4de_di_quanti_sd_e) * scaleFactor * SD_FACTOR * ExtremeFactor,\r\n      di_Ea_e: getAbsoluteImpact(riskFile.cr4de_di_quanti_ea_e) * scaleFactor * EaScaleFactor * ExtremeFactor,\r\n      di_Fa_e: getAbsoluteImpact(riskFile.cr4de_di_quanti_fa_e) * scaleFactor * ExtremeFactor,\r\n      di_Fb_e: getAbsoluteImpact(riskFile.cr4de_di_quanti_fb_e) * scaleFactor * ExtremeFactor,\r\n\r\n      dp50_c: riskFile.cr4de_climate_change_quanti_c\r\n        ? getAbsoluteProbability(riskFile.cr4de_climate_change_quanti_c)\r\n        : getAbsoluteProbability(riskFile.cr4de_dp_quanti_c, DPScaleFactor),\r\n      dp50_m: riskFile.cr4de_climate_change_quanti_m\r\n        ? getAbsoluteProbability(riskFile.cr4de_climate_change_quanti_m)\r\n        : getAbsoluteProbability(riskFile.cr4de_dp_quanti_m, DPScaleFactor),\r\n      dp50_e: riskFile.cr4de_climate_change_quanti_e\r\n        ? getAbsoluteProbability(riskFile.cr4de_climate_change_quanti_e)\r\n        : getAbsoluteProbability(riskFile.cr4de_dp_quanti_e, DPScaleFactor),\r\n    };\r\n\r\n  if (goodDAs.length > 0)\r\n    return {\r\n      quality: Quality.AVERAGE,\r\n      reliability: goodDAs.length,\r\n      ...getAveragesForScenarios(\"dp\", \"dp\", \"cr4de_dp_quanti\", goodDAs, getAbsoluteProbability),\r\n      ...getAveragesForScenarios(\"di_Ha\", \"h\", \"cr4de_di_quanti_ha\", goodDAs, getAbsoluteImpact),\r\n      ...getAveragesForScenarios(\"di_Hb\", \"h\", \"cr4de_di_quanti_hb\", goodDAs, getAbsoluteImpact),\r\n      ...getAveragesForScenarios(\"di_Hc\", \"h\", \"cr4de_di_quanti_hc\", goodDAs, getAbsoluteImpact),\r\n      ...getAveragesForScenarios(\"di_Sa\", \"s\", \"cr4de_di_quanti_sa\", goodDAs, getAbsoluteImpact),\r\n      ...getAveragesForScenarios(\"di_Sb\", \"s\", \"cr4de_di_quanti_sb\", goodDAs, getAbsoluteImpact),\r\n      ...getAveragesForScenarios(\"di_Sc\", \"s\", \"cr4de_di_quanti_sc\", goodDAs, getAbsoluteImpact),\r\n      ...getAveragesForScenarios(\"di_Sd\", \"s\", \"cr4de_di_quanti_sd\", goodDAs, getAbsoluteImpact),\r\n      ...getAveragesForScenarios(\"di_Ea\", \"e\", \"cr4de_di_quanti_ea\", goodDAs, getAbsoluteImpact),\r\n      ...getAveragesForScenarios(\"di_Fa\", \"f\", \"cr4de_di_quanti_fa\", goodDAs, getAbsoluteImpact),\r\n      ...getAveragesForScenarios(\"di_Fb\", \"f\", \"cr4de_di_quanti_fb\", goodDAs, getAbsoluteImpact),\r\n      ...getAveragesForScenarios(\"dp50\", \"cc\", \"cr4de_climate_change_quanti\", goodDAs, getAbsoluteProbability),\r\n    } as RiskCalculationKnownFields;\r\n\r\n  return {\r\n    quality: Quality.MISSING,\r\n    reliability: 0,\r\n    dp_c: 0,\r\n    dp_m: 0,\r\n    dp_e: 0,\r\n\r\n    di_Ha_c: 0,\r\n    di_Hb_c: 0,\r\n    di_Hc_c: 0,\r\n    di_Sa_c: 0,\r\n    di_Sb_c: 0,\r\n    di_Sc_c: 0,\r\n    di_Sd_c: 0,\r\n    di_Ea_c: 0,\r\n    di_Fa_c: 0,\r\n    di_Fb_c: 0,\r\n\r\n    di_Ha_m: 0,\r\n    di_Hb_m: 0,\r\n    di_Hc_m: 0,\r\n    di_Sa_m: 0,\r\n    di_Sb_m: 0,\r\n    di_Sc_m: 0,\r\n    di_Sd_m: 0,\r\n    di_Ea_m: 0,\r\n    di_Fa_m: 0,\r\n    di_Fb_m: 0,\r\n\r\n    di_Ha_e: 0,\r\n    di_Hb_e: 0,\r\n    di_Hc_e: 0,\r\n    di_Sa_e: 0,\r\n    di_Sb_e: 0,\r\n    di_Sc_e: 0,\r\n    di_Sd_e: 0,\r\n    di_Ea_e: 0,\r\n    di_Fa_e: 0,\r\n    di_Fb_e: 0,\r\n\r\n    dp50_c: 0,\r\n    dp50_m: 0,\r\n    dp50_e: 0,\r\n  };\r\n};\r\n\r\nconst getConsensusCascade = (\r\n  cause: DVRiskFile,\r\n  effect: DVRiskFile,\r\n  cascade: DVRiskCascade,\r\n  participations: DVParticipation[],\r\n  cascadeAnalyses: DVCascadeAnalysis<unknown, unknown, DVContact>[] | undefined\r\n) => {\r\n  const goodCAs = cascadeAnalyses\r\n    ? cascadeAnalyses\r\n        .filter((ca) =>\r\n          participations.some(\r\n            (p) =>\r\n              p._cr4de_contact_value === ca.cr4de_expert.contactid &&\r\n              p.cr4de_role === \"expert\" &&\r\n              p.cr4de_direct_analysis_finished\r\n          )\r\n        )\r\n        .map((ca) => {\r\n          if (\r\n            effect.cr4de_title.indexOf(\"food supply\") >= 0 &&\r\n            ca.cr4de_expert.emailaddress1 === \"laurie.phillips@economie.fgov.be\"\r\n          ) {\r\n            return {\r\n              ...ca,\r\n              cr4de_c2c: ca.cr4de_c2e,\r\n              cr4de_c2e: ca.cr4de_c2c,\r\n              cr4de_m2c: ca.cr4de_m2e,\r\n              cr4de_m2e: ca.cr4de_m2c,\r\n              cr4de_e2c: ca.cr4de_e2e,\r\n              cr4de_e2e: ca.cr4de_e2c,\r\n            };\r\n          }\r\n          return ca;\r\n        })\r\n    : [];\r\n\r\n  let cpScaleFactor = 1;\r\n  if (\r\n    cause.cr4de_riskfilesid === \"9458db5b-aa6c-ed11-9561-000d3adf7089\" ||\r\n    effect.cr4de_riskfilesid === \"9458db5b-aa6c-ed11-9561-000d3adf7089\"\r\n  ) {\r\n    cpScaleFactor *= INFO_OPS_CP_FACTOR;\r\n  }\r\n  if (\r\n    [\"M01\", \"MO2\", \"M03\", \"M04\", \"M05\"].indexOf(cause.cr4de_hazard_id) >= 0 &&\r\n    effect.cr4de_title.indexOf(\"Attack\") >= 0\r\n  ) {\r\n    cpScaleFactor *= ATTACK_FACTOR;\r\n  }\r\n  const extremeScaleFactor = effect.cr4de_title.indexOf(\"International Armed\") >= 0 ? IAC_FACTOR : 1;\r\n\r\n  if (\r\n    ((effect.cr4de_consensus_date && new Date(effect.cr4de_consensus_date) <= new Date()) ||\r\n      effect.cr4de_risk_type === RISK_TYPE.EMERGING) &&\r\n    (effect.cr4de_title.indexOf(\"food supply\") < 0 ||\r\n      [\r\n        \"Failure of electricity supply\",\r\n        \"Failure of road transport\",\r\n        \"Agricultural Plant Diseases & Pests\",\r\n        \"Commodities shortage\",\r\n      ].indexOf(cause.cr4de_title) < 0)\r\n  ) {\r\n    return {\r\n      quality: Quality.CONSENSUS,\r\n      reliabilty: goodCAs.length,\r\n      c2c: getAbsoluteProbability(cascade.cr4de_c2c) * cpScaleFactor,\r\n      c2m: getAbsoluteProbability(cascade.cr4de_c2m) * cpScaleFactor,\r\n      c2e: getAbsoluteProbability(cascade.cr4de_c2e) * cpScaleFactor * extremeScaleFactor,\r\n      m2c: getAbsoluteProbability(cascade.cr4de_m2c) * cpScaleFactor,\r\n      m2m: getAbsoluteProbability(cascade.cr4de_m2m) * cpScaleFactor,\r\n      m2e: getAbsoluteProbability(cascade.cr4de_m2e) * cpScaleFactor * extremeScaleFactor,\r\n      e2c: getAbsoluteProbability(cascade.cr4de_e2c) * cpScaleFactor,\r\n      e2m: getAbsoluteProbability(cascade.cr4de_e2m) * cpScaleFactor,\r\n      e2e: getAbsoluteProbability(cascade.cr4de_e2e) * cpScaleFactor * extremeScaleFactor,\r\n    };\r\n  }\r\n\r\n  if (goodCAs.length > 0) {\r\n    return {\r\n      quality: Quality.AVERAGE,\r\n      reliabilty: goodCAs.length,\r\n      c2c:\r\n        getAbsoluteProbability(\r\n          getAverage(\r\n            goodCAs.map((ca) => ca.cr4de_c2c),\r\n            goodCAs.map((ca) => ca.cr4de_quality || 2.5)\r\n          )\r\n        ) * cpScaleFactor,\r\n      c2m:\r\n        getAbsoluteProbability(\r\n          getAverage(\r\n            goodCAs.map((ca) => ca.cr4de_c2m),\r\n            goodCAs.map((ca) => ca.cr4de_quality || 2.5)\r\n          )\r\n        ) * cpScaleFactor,\r\n      c2e:\r\n        getAbsoluteProbability(\r\n          getAverage(\r\n            goodCAs.map((ca) => ca.cr4de_c2e),\r\n            goodCAs.map((ca) => ca.cr4de_quality || 2.5)\r\n          )\r\n        ) * cpScaleFactor,\r\n      m2c:\r\n        getAbsoluteProbability(\r\n          getAverage(\r\n            goodCAs.map((ca) => ca.cr4de_m2c),\r\n            goodCAs.map((ca) => ca.cr4de_quality || 2.5)\r\n          )\r\n        ) * cpScaleFactor,\r\n      m2m:\r\n        getAbsoluteProbability(\r\n          getAverage(\r\n            goodCAs.map((ca) => ca.cr4de_m2m),\r\n            goodCAs.map((ca) => ca.cr4de_quality || 2.5)\r\n          )\r\n        ) * cpScaleFactor,\r\n      m2e:\r\n        getAbsoluteProbability(\r\n          getAverage(\r\n            goodCAs.map((ca) => ca.cr4de_m2e),\r\n            goodCAs.map((ca) => ca.cr4de_quality || 2.5)\r\n          )\r\n        ) * cpScaleFactor,\r\n      e2c:\r\n        getAbsoluteProbability(\r\n          getAverage(\r\n            goodCAs.map((ca) => ca.cr4de_e2c),\r\n            goodCAs.map((ca) => ca.cr4de_quality || 2.5)\r\n          )\r\n        ) * cpScaleFactor,\r\n      e2m:\r\n        getAbsoluteProbability(\r\n          getAverage(\r\n            goodCAs.map((ca) => ca.cr4de_e2m),\r\n            goodCAs.map((ca) => ca.cr4de_quality || 2.5)\r\n          )\r\n        ) * cpScaleFactor,\r\n      e2e:\r\n        getAbsoluteProbability(\r\n          getAverage(\r\n            goodCAs.map((ca) => ca.cr4de_e2e),\r\n            goodCAs.map((ca) => ca.cr4de_quality || 2.5)\r\n          )\r\n        ) * cpScaleFactor,\r\n    };\r\n  }\r\n\r\n  return {\r\n    quality: Quality.MISSING,\r\n    reliabilty: 0,\r\n    c2c: 0,\r\n    c2m: 0,\r\n    c2e: 0,\r\n    m2c: 0,\r\n    m2m: 0,\r\n    m2e: 0,\r\n    e2c: 0,\r\n    e2m: 0,\r\n    e2e: 0,\r\n  };\r\n};\r\n\r\nconst getNormalizedCascade = (c: ReturnType<typeof getConsensusCascade>) => {\r\n  const c20 = (1 - c.c2c) * (1 - c.c2m) * (1 - c.c2e);\r\n  const m20 = (1 - c.m2c) * (1 - c.m2m) * (1 - c.m2e);\r\n  const e20 = (1 - c.e2c) * (1 - c.e2m) * (1 - c.e2e);\r\n\r\n  const cTot = c20 + c.c2c + c.c2m + c.c2e;\r\n  const mTot = m20 + c.m2c + c.m2m + c.m2e;\r\n  const eTot = e20 + c.e2c + c.e2m + c.e2e;\r\n\r\n  return {\r\n    ...c,\r\n    c2c: c.c2c / cTot,\r\n    c2m: c.c2m / cTot,\r\n    c2e: c.c2e / cTot,\r\n    m2c: c.m2c / mTot,\r\n    m2m: c.m2m / mTot,\r\n    m2e: c.m2e / mTot,\r\n    e2c: c.e2c / eTot,\r\n    e2m: c.e2m / eTot,\r\n    e2e: c.e2e / eTot,\r\n  };\r\n};\r\n\r\nexport default function prepareRiskFiles(\r\n  riskFiles: DVRiskFile[],\r\n  riskFilesDict: { [key: string]: DVRiskFile },\r\n  cascades: DVRiskCascade<SmallRisk, SmallRisk>[],\r\n  participations: DVParticipation[],\r\n  directAnalyses: DVDirectAnalysis<unknown, DVContact>[],\r\n  cascadeAnalyses: DVCascadeAnalysis<unknown, unknown, DVContact>[]\r\n): RiskCalculation[] {\r\n  const daDict: { [key: string]: DVDirectAnalysis<unknown, DVContact>[] } = directAnalyses.reduce((acc, da) => {\r\n    if (!acc[da._cr4de_risk_file_value]) {\r\n      return {\r\n        ...acc,\r\n        [da._cr4de_risk_file_value]: [da],\r\n      };\r\n    }\r\n    return {\r\n      ...acc,\r\n      [da._cr4de_risk_file_value]: [...acc[da._cr4de_risk_file_value], da],\r\n    };\r\n  }, {} as { [key: string]: DVDirectAnalysis<unknown, DVContact>[] });\r\n\r\n  const caDict: { [key: string]: DVCascadeAnalysis<unknown, unknown, DVContact>[] } = cascadeAnalyses.reduce(\r\n    (acc, ca) => {\r\n      if (!acc[ca._cr4de_cascade_value]) {\r\n        return {\r\n          ...acc,\r\n          [ca._cr4de_cascade_value]: [ca],\r\n        };\r\n      }\r\n      return {\r\n        ...acc,\r\n        [ca._cr4de_cascade_value]: [...acc[ca._cr4de_cascade_value], ca],\r\n      };\r\n    },\r\n    {} as { [key: string]: DVCascadeAnalysis<unknown, unknown, DVContact>[] }\r\n  );\r\n\r\n  const calculations: RiskCalculation[] = riskFiles\r\n    .filter((rf) => rf.cr4de_risk_type !== RISK_TYPE.EMERGING)\r\n    .map((rf) => {\r\n      const crf = getConsensusRiskFile(\r\n        rf,\r\n        participations.filter((p) => p._cr4de_risk_file_value === rf.cr4de_riskfilesid),\r\n        daDict[rf.cr4de_riskfilesid]\r\n      );\r\n\r\n      const c = {\r\n        riskId: rf.cr4de_riskfilesid,\r\n        riskTitle: rf.cr4de_title,\r\n\r\n        timestamp: Date.now(),\r\n\r\n        // Initialize known fields\r\n        ...crf,\r\n\r\n        // Initialize unknown fields\r\n        dp: 0,\r\n        dp50: 0,\r\n\r\n        ip_c: 0,\r\n        ip_m: 0,\r\n        ip_e: 0,\r\n\r\n        ip: 0,\r\n\r\n        ip50_c: 0,\r\n        ip50_m: 0,\r\n        ip50_e: 0,\r\n\r\n        ip50: 0,\r\n\r\n        tp_c: 0,\r\n        tp_m: 0,\r\n        tp_e: 0,\r\n\r\n        tp: 0,\r\n\r\n        tp50_c: 0,\r\n        tp50_m: 0,\r\n        tp50_e: 0,\r\n\r\n        tp50: 0,\r\n\r\n        rp_c: 0,\r\n        rp_m: 0,\r\n        rp_e: 0,\r\n\r\n        di_Ha: crf.di_Ha_c + crf.di_Ha_m + crf.di_Ha_e,\r\n        di_Hb: crf.di_Hb_c + crf.di_Hb_m + crf.di_Hb_e,\r\n        di_Hc: crf.di_Hc_c + crf.di_Hc_m + crf.di_Hc_e,\r\n        di_Sa: crf.di_Sa_c + crf.di_Sa_m + crf.di_Sa_e,\r\n        di_Sb: crf.di_Sb_c + crf.di_Sb_m + crf.di_Sb_e,\r\n        di_Sc: crf.di_Sc_c + crf.di_Sc_m + crf.di_Sc_e,\r\n        di_Sd: crf.di_Sd_c + crf.di_Sd_m + crf.di_Sd_e,\r\n        di_Ea: crf.di_Ea_c + crf.di_Ea_m + crf.di_Ea_e,\r\n        di_Fa: crf.di_Fa_c + crf.di_Fa_m + crf.di_Fa_e,\r\n        di_Fb: crf.di_Fb_c + crf.di_Fb_m + crf.di_Fb_e,\r\n\r\n        di_c:\r\n          crf.di_Ha_c +\r\n          crf.di_Hb_c +\r\n          crf.di_Hc_c +\r\n          crf.di_Sa_c +\r\n          crf.di_Sb_c +\r\n          crf.di_Sc_c +\r\n          crf.di_Sd_c +\r\n          crf.di_Ea_c +\r\n          crf.di_Fa_c +\r\n          crf.di_Fb_c,\r\n        di_m:\r\n          crf.di_Ha_m +\r\n          crf.di_Hb_m +\r\n          crf.di_Hc_m +\r\n          crf.di_Sa_m +\r\n          crf.di_Sb_m +\r\n          crf.di_Sc_m +\r\n          crf.di_Sd_m +\r\n          crf.di_Ea_m +\r\n          crf.di_Fa_m +\r\n          crf.di_Fb_m,\r\n        di_e:\r\n          crf.di_Ha_e +\r\n          crf.di_Hb_e +\r\n          crf.di_Hc_e +\r\n          crf.di_Sa_e +\r\n          crf.di_Sb_e +\r\n          crf.di_Sc_e +\r\n          crf.di_Sd_e +\r\n          crf.di_Ea_e +\r\n          crf.di_Fa_e +\r\n          crf.di_Fb_e,\r\n\r\n        di: 0,\r\n\r\n        ii_Ha_c: 0,\r\n        ii_Hb_c: 0,\r\n        ii_Hc_c: 0,\r\n        ii_Sa_c: 0,\r\n        ii_Sb_c: 0,\r\n        ii_Sc_c: 0,\r\n        ii_Sd_c: 0,\r\n        ii_Ea_c: 0,\r\n        ii_Fa_c: 0,\r\n        ii_Fb_c: 0,\r\n\r\n        ii_Ha_m: 0,\r\n        ii_Hb_m: 0,\r\n        ii_Hc_m: 0,\r\n        ii_Sa_m: 0,\r\n        ii_Sb_m: 0,\r\n        ii_Sc_m: 0,\r\n        ii_Sd_m: 0,\r\n        ii_Ea_m: 0,\r\n        ii_Fa_m: 0,\r\n        ii_Fb_m: 0,\r\n\r\n        ii_Ha_e: 0,\r\n        ii_Hb_e: 0,\r\n        ii_Hc_e: 0,\r\n        ii_Sa_e: 0,\r\n        ii_Sb_e: 0,\r\n        ii_Sc_e: 0,\r\n        ii_Sd_e: 0,\r\n        ii_Ea_e: 0,\r\n        ii_Fa_e: 0,\r\n        ii_Fb_e: 0,\r\n\r\n        ii_Ha: 0,\r\n        ii_Hb: 0,\r\n        ii_Hc: 0,\r\n        ii_Sa: 0,\r\n        ii_Sb: 0,\r\n        ii_Sc: 0,\r\n        ii_Sd: 0,\r\n        ii_Ea: 0,\r\n        ii_Fa: 0,\r\n        ii_Fb: 0,\r\n\r\n        ii_c: 0,\r\n        ii_m: 0,\r\n        ii_e: 0,\r\n\r\n        ii: 0,\r\n\r\n        ti_Ha_c: 0,\r\n        ti_Hb_c: 0,\r\n        ti_Hc_c: 0,\r\n        ti_Sa_c: 0,\r\n        ti_Sb_c: 0,\r\n        ti_Sc_c: 0,\r\n        ti_Sd_c: 0,\r\n        ti_Ea_c: 0,\r\n        ti_Fa_c: 0,\r\n        ti_Fb_c: 0,\r\n\r\n        ti_Ha_m: 0,\r\n        ti_Hb_m: 0,\r\n        ti_Hc_m: 0,\r\n        ti_Sa_m: 0,\r\n        ti_Sb_m: 0,\r\n        ti_Sc_m: 0,\r\n        ti_Sd_m: 0,\r\n        ti_Ea_m: 0,\r\n        ti_Fa_m: 0,\r\n        ti_Fb_m: 0,\r\n\r\n        ti_Ha_e: 0,\r\n        ti_Hb_e: 0,\r\n        ti_Hc_e: 0,\r\n        ti_Sa_e: 0,\r\n        ti_Sb_e: 0,\r\n        ti_Sc_e: 0,\r\n        ti_Sd_e: 0,\r\n        ti_Ea_e: 0,\r\n        ti_Fa_e: 0,\r\n        ti_Fb_e: 0,\r\n\r\n        ti_Ha: 0,\r\n        ti_Hb: 0,\r\n        ti_Hc: 0,\r\n        ti_Sa: 0,\r\n        ti_Sb: 0,\r\n        ti_Sc: 0,\r\n        ti_Sd: 0,\r\n        ti_Ea: 0,\r\n        ti_Fa: 0,\r\n        ti_Fb: 0,\r\n\r\n        ti_c: 0,\r\n        ti_m: 0,\r\n        ti_e: 0,\r\n\r\n        ti: 0,\r\n\r\n        tr_c: 0,\r\n        tr_m: 0,\r\n        tr_e: 0,\r\n\r\n        tr: 0,\r\n\r\n        tr50_c: 0,\r\n        tr50_m: 0,\r\n        tr50_e: 0,\r\n\r\n        tr50: 0,\r\n\r\n        causes: [],\r\n        effects: [],\r\n      };\r\n\r\n      c.di = c.di_c + c.di_m + c.di_e;\r\n\r\n      return c;\r\n    });\r\n\r\n  // Create a lookup table so we can easily find a calculation by the id of its risk file\r\n  const calculationsDict: { [key: string]: RiskCalculation } = calculations.reduce(\r\n    (dict, calculation) => ({\r\n      ...dict,\r\n      [calculation.riskId]: calculation,\r\n    }),\r\n    {}\r\n  );\r\n\r\n  const hasTitle = (cascade: DVRiskCascade<SmallRisk, SmallRisk>, titles: string[]) => {\r\n    return titles.some(\r\n      (t) =>\r\n        cascade.cr4de_cause_hazard.cr4de_title.indexOf(t) >= 0 ||\r\n        cascade.cr4de_effect_hazard.cr4de_title.indexOf(t) >= 0\r\n    );\r\n  };\r\n\r\n  // Create links between the risk file calculation objects according to the risk cascades\r\n  cascades.forEach((c) => {\r\n    if (c.cr4de_cause_hazard.cr4de_risk_type === RISK_TYPE.EMERGING) return;\r\n\r\n    // if (hasTitle(c, [\"Information\", \"Subsidence\", \"Espionage\", \"Interference\"])) return;\r\n    // if (hasTitle(c, [\"Information\", \"sewage\", \"Building Struct\", \"Unrest\", \"Substandard\"])) return;\r\n\r\n    const cause = calculationsDict[c._cr4de_cause_hazard_value];\r\n    const effect = calculationsDict[c._cr4de_effect_hazard_value];\r\n\r\n    if (!cause || !effect) return;\r\n\r\n    const cascadeCalculation = {\r\n      cause: cause,\r\n      effect: effect,\r\n\r\n      cascadeId: c.cr4de_bnrariskcascadeid,\r\n      cascadeTitle: `${cause.riskTitle} causes ${effect.riskTitle}`,\r\n\r\n      damp: c.cr4de_damp || true,\r\n\r\n      ...getNormalizedCascade(\r\n        getConsensusCascade(\r\n          riskFilesDict[c._cr4de_cause_hazard_value],\r\n          riskFilesDict[c._cr4de_effect_hazard_value],\r\n          c,\r\n          participations.filter(\r\n            (p) =>\r\n              p._cr4de_risk_file_value === c._cr4de_cause_hazard_value ||\r\n              p._cr4de_risk_file_value === c._cr4de_effect_hazard_value\r\n          ),\r\n          caDict[c.cr4de_bnrariskcascadeid]\r\n        )\r\n      ),\r\n\r\n      ip_c: 0,\r\n      ip_m: 0,\r\n      ip_e: 0,\r\n\r\n      ip: 0,\r\n\r\n      ip50_c: 0,\r\n      ip50_m: 0,\r\n      ip50_e: 0,\r\n\r\n      ip50: 0,\r\n\r\n      ii_Ha_c: 0,\r\n      ii_Hb_c: 0,\r\n      ii_Hc_c: 0,\r\n      ii_Sa_c: 0,\r\n      ii_Sb_c: 0,\r\n      ii_Sc_c: 0,\r\n      ii_Sd_c: 0,\r\n      ii_Ea_c: 0,\r\n      ii_Fa_c: 0,\r\n      ii_Fb_c: 0,\r\n\r\n      ii_Ha_m: 0,\r\n      ii_Hb_m: 0,\r\n      ii_Hc_m: 0,\r\n      ii_Sa_m: 0,\r\n      ii_Sb_m: 0,\r\n      ii_Sc_m: 0,\r\n      ii_Sd_m: 0,\r\n      ii_Ea_m: 0,\r\n      ii_Fa_m: 0,\r\n      ii_Fb_m: 0,\r\n\r\n      ii_Ha_e: 0,\r\n      ii_Hb_e: 0,\r\n      ii_Hc_e: 0,\r\n      ii_Sa_e: 0,\r\n      ii_Sb_e: 0,\r\n      ii_Sc_e: 0,\r\n      ii_Sd_e: 0,\r\n      ii_Ea_e: 0,\r\n      ii_Fa_e: 0,\r\n      ii_Fb_e: 0,\r\n\r\n      ii_Ha: 0,\r\n      ii_Hb: 0,\r\n      ii_Hc: 0,\r\n      ii_Sa: 0,\r\n      ii_Sb: 0,\r\n      ii_Sc: 0,\r\n      ii_Sd: 0,\r\n      ii_Ea: 0,\r\n      ii_Fa: 0,\r\n      ii_Fb: 0,\r\n\r\n      ii_c: 0,\r\n      ii_m: 0,\r\n      ii_e: 0,\r\n\r\n      ii: 0,\r\n\r\n      ir_c: 0,\r\n      ir_m: 0,\r\n      ir_e: 0,\r\n\r\n      ir: 0,\r\n\r\n      ir50_c: 0,\r\n      ir50_m: 0,\r\n      ir50_e: 0,\r\n\r\n      ir50: 0,\r\n    };\r\n\r\n    // if (\r\n    //   (cascadeCalculation.c2c +\r\n    //     cascadeCalculation.c2m +\r\n    //     cascadeCalculation.c2e +\r\n    //     cascadeCalculation.m2c +\r\n    //     cascadeCalculation.m2m +\r\n    //     cascadeCalculation.m2e +\r\n    //     cascadeCalculation.e2c +\r\n    //     cascadeCalculation.e2m +\r\n    //     cascadeCalculation.e2e) /\r\n    //     9 >\r\n    //   0.3\r\n    // ) {\r\n    //   console.log(\r\n    //     `${cascadeCalculation.cascadeTitle}: ${\r\n    //       (cascadeCalculation.c2c +\r\n    //         cascadeCalculation.c2m +\r\n    //         cascadeCalculation.c2e +\r\n    //         cascadeCalculation.m2c +\r\n    //         cascadeCalculation.m2m +\r\n    //         cascadeCalculation.m2e +\r\n    //         cascadeCalculation.e2c +\r\n    //         cascadeCalculation.e2m +\r\n    //         cascadeCalculation.e2e) /\r\n    //       9\r\n    //     }`\r\n    //   );\r\n    //   return;\r\n    // }\r\n\r\n    cause.effects.push(cascadeCalculation);\r\n    effect.causes.push(cascadeCalculation);\r\n  });\r\n\r\n  return calculations;\r\n}\r\n","import { DVCascadeAnalysis } from \"../../types/dataverse/DVCascadeAnalysis\";\r\nimport { DVContact } from \"../../types/dataverse/DVContact\";\r\nimport { DVDirectAnalysis } from \"../../types/dataverse/DVDirectAnalysis\";\r\nimport { DVParticipation } from \"../../types/dataverse/DVParticipation\";\r\nimport { DVRiskCascade } from \"../../types/dataverse/DVRiskCascade\";\r\nimport { DVRiskFile } from \"../../types/dataverse/DVRiskFile\";\r\nimport { SmallRisk } from \"../../types/dataverse/DVSmallRisk\";\r\nimport { SCENARIOS } from \"../scenarios\";\r\nimport calculateTotalImpact, { getEffectGraph } from \"./calculateTotalImpact\";\r\nimport calculateTotalProbability, { getCausalGraph } from \"./calculateTotalProbability\";\r\nimport calculateTotalRisk from \"./calculateTotalRisk\";\r\nimport prepareRiskFiles from \"./prepareRiskFiles\";\r\n\r\nexport default function runAnalysis(\r\n  {\r\n    riskFiles,\r\n    cascades,\r\n    participations,\r\n    directAnalyses,\r\n    cascadeAnalyses,\r\n  }: // runs,\r\n  // damping,\r\n  // log,\r\n  // setCalculationProgress,\r\n  {\r\n    riskFiles: DVRiskFile[];\r\n    cascades: DVRiskCascade<SmallRisk, SmallRisk>[];\r\n    //   contacts: DVContact[];\r\n    participations: DVParticipation[];\r\n    directAnalyses: DVDirectAnalysis<unknown, DVContact>[];\r\n    cascadeAnalyses: DVCascadeAnalysis<unknown, unknown, DVContact>[];\r\n    // runs: number;\r\n    // damping: number;\r\n    // log: (l: string) => void;\r\n  },\r\n  setCalculationProgress: (l: number) => void\r\n) {\r\n  const riskFilesDict = riskFiles.reduce(\r\n    (d, c) => ({\r\n      ...d,\r\n      [c.cr4de_riskfilesid]: c,\r\n    }),\r\n    {} as { [key: string]: DVRiskFile }\r\n  );\r\n  const cascadesDict = cascades.reduce(\r\n    (d, c) => ({\r\n      ...d,\r\n      [c.cr4de_bnrariskcascadeid]: c,\r\n    }),\r\n    {}\r\n  );\r\n\r\n  const calculations = prepareRiskFiles(\r\n    riskFiles,\r\n    riskFilesDict,\r\n    cascades,\r\n    participations,\r\n    directAnalyses,\r\n    cascadeAnalyses\r\n  );\r\n\r\n  return calculations.map((c, i) => {\r\n    const graph = getEffectGraph(getCausalGraph(c));\r\n    console.log(\"ok\");\r\n    // if (c.riskTitle.indexOf(\"lectricity\") < 0) return c;\r\n\r\n    calculateTotalProbability(graph);\r\n    calculateTotalImpact(graph);\r\n    calculateTotalRisk(graph);\r\n\r\n    // console.log((100 * (i + 1)) / calculations.length);\r\n    setCalculationProgress((100 * (i + 1)) / calculations.length);\r\n\r\n    // console.log(`(${i + 1}/${calculations.length}) - Starting calculation for \"${c.riskTitle}\"`);\r\n    // c.tp_c = calculateTotalProbability(c, SCENARIOS.CONSIDERABLE);\r\n    // c.tp_m = calculateTotalProbability(c, SCENARIOS.MAJOR);\r\n    // c.tp_e = calculateTotalProbability(c, SCENARIOS.EXTREME);\r\n    // c.causes.forEach((cascade) => (c.ip = c.ip_c + c.ip_m + c.ip_e));\r\n\r\n    return graph;\r\n  });\r\n}\r\n","/* eslint-disable no-restricted-globals */\r\n// import { RiskCalculation } from \"../../types/dataverse/DVAnalysisRun\";\r\n// import { DVCascadeAnalysis } from \"../../types/dataverse/DVCascadeAnalysis\";\r\n// import { DVContact } from \"../../types/dataverse/DVContact\";\r\n// import { DVDirectAnalysis } from \"../../types/dataverse/DVDirectAnalysis\";\r\n// import { DVParticipation } from \"../../types/dataverse/DVParticipation\";\r\n// import { DVRiskCascade } from \"../../types/dataverse/DVRiskCascade\";\r\n// import { DVRiskFile } from \"../../types/dataverse/DVRiskFile\";\r\n// import { SmallRisk } from \"../../types/dataverse/DVSmallRisk\";\r\nimport runAnalysis from \"./runAnalysis\";\r\n\r\n// export interface CalculatorParams {\r\n//   riskFiles: DVRiskFile[];\r\n//   cascades: DVRiskCascade<SmallRisk, SmallRisk>[];\r\n//   participations: DVParticipation[];\r\n//   directAnalyses: DVDirectAnalysis<unknown, DVContact>[];\r\n//   cascadeAnalyses: DVCascadeAnalysis<unknown, unknown, DVContact>[];\r\n// }\r\n\r\n// export type MessageParams =\r\n//   | {\r\n//       type: \"progress\";\r\n//       value: number;\r\n//     }\r\n//   | {\r\n//       type: \"result\";\r\n//       value: RiskCalculation[];\r\n//     };\r\n\r\n// self.onmessage = (e: MessageEvent<CalculatorParams>) => {\r\n//   const calcs = runAnalysis(e.data, (progress: number) =>\r\n//     self.postMessage({ type: \"progress\", value: progress } as MessageParams)\r\n//   );\r\n\r\n//   self.postMessage({\r\n//     type: \"result\",\r\n//     value: calcs,\r\n//   });\r\n// };\r\nself.onmessage = (e) => {\r\n  const calcs = runAnalysis(e.data, (progress) => self.postMessage({ type: \"progress\", value: progress }));\r\n\r\n  self.postMessage({\r\n    type: \"result\",\r\n    value: calcs,\r\n  });\r\n};\r\n\r\nexport {};\r\n\r\n// export default () => {\r\n//   // eslint-disable-next-line no-restricted-globals\r\n//   self.addEventListener(\"message\", (e?: { data: CalculatorParams }) => {\r\n//     console.log(\"Running\");\r\n//     if (!e) return;\r\n//     const calcs = runAnalysis(e.data);\r\n//     console.log(calcs);\r\n//     // let { users, type } = e.data;\r\n\r\n//     // if (type === \"asc\") {\r\n//     //   users = users.sort((a, b) => a.commentCount - b.commentCount);\r\n//     // } else {\r\n//     //   users = users.sort((a, b) => b.commentCount - a.commentCount);\r\n//     // }\r\n\r\n//     postMessage(null);\r\n//   });\r\n// };\r\n"],"names":["_typeof","o","Symbol","iterator","constructor","prototype","_toPropertyKey","arg","key","input","hint","prim","toPrimitive","undefined","res","call","TypeError","String","Number","obj","value","Object","defineProperty","enumerable","configurable","writable","ownKeys","e","r","t","keys","getOwnPropertySymbols","filter","getOwnPropertyDescriptor","push","apply","_objectSpread2","arguments","length","forEach","getOwnPropertyDescriptors","defineProperties","_arrayLikeToArray","arr","len","i","arr2","Array","isArray","iter","from","minLen","n","toString","slice","name","test","SCENARIOS","CONSIDERABLE","titleI18N","titleDefault","color","prefix","MAJOR","EXTREME","DAMAGE_INDICATORS","getScenarioSuffix","scenario","getCP","cascade","fromScenario","toScenario","c2c","c2m","c2e","m2c","m2m","m2e","e2c","e2m","e2e","getEffectGraphRecurse","cascades","visitedRiskIds","nextLevel","nextVisitedIds","map","c","effect","riskId","c1","effects","c2","indexOf","nextLevelEffects","reduce","filteredEffects","nextLevelEffect","find","c3","calculateTotalImpact","risk","calculateTotalImpactScenario","suffix","di_c","di_m","di_e","getDI","iiTot","ti","s2c","s2m","s2e","d","setIndirectImpacts","ii_c","ii_m","ii_e","getII","tot","getCausalGraphRecurse","cause","causes","nextLevelCauses","filteredCauses","nextLevelCause","calculateTotalProbability","tp_c","calculateTotalProbabilityScenario","tp_m","tp_e","tp","tp50_c","calculateTotalProbability2050Scenario","tp50_m","tp50_e","tp50","dp_c","dp_m","dp_e","getDP","ipTot","ip","ip_c","ip_m","ip_e","setIP","getIP","dp50_c","dp50_m","dp50_e","getDP50","ip50_c","ip50_m","ip50_e","setIP50","ip50","getIP50","Quality","RISK_TYPE","CONSENSUS_TYPE","calculateTotalRisk","tr_c","ti_c","tr_m","ti_m","tr_e","ti_e","tr","tr50_c","tr50_m","tr50_e","tr50","ir_c","ir_m","ir_e","ir","ir50_c","ir50_m","ir50_e","ir50","wcsSuffix","calculation","rs","Math","max","getWorstCaseScenario","dp","dp50","di","ii","scales","getAbsoluteImpact","scaleString","DPScales","MScales","CPScales","logMean","x","y","log10","mean","getDPDailyProbability","exp","DPScaleString","scaleNumber","floor","parseFloat","replace","parseInt","getReturnPeriod","getMDailyProbability","log","MScaleString","get3YearLikelihood","getAbsoluteProbability","scaleFactor","startsWith","PARAMETER","f","DP","label","DP2050","H","S","E","F","CB","getQuantiNumbers","quantiInput","good","search","numbers","avg","weights","totalWeight","cur","round","getAverage","SC_FACTOR","getAveragesForScenarios","parameter","field","directAnalyses","absoluteValueGetter","daField","factor","da","cr4de_quality","prepareRiskFiles","riskFiles","riskFilesDict","participations","cascadeAnalyses","daDict","acc","_cr4de_risk_file_value","caDict","ca","_cr4de_cascade_value","calculations","rf","cr4de_risk_type","crf","riskFile","goodDAs","some","p","_cr4de_contact_value","cr4de_expert","contactid","cr4de_role","cr4de_direct_analysis_finished","cr4de_title","DPScaleFactor","ExtremeFactor","cr4de_consensus_date","Date","quality","CONSENSUS","reliability","cr4de_dp_quanti_c","cr4de_dp_quanti_m","cr4de_dp_quanti_e","di_Ha_c","cr4de_di_quanti_ha_c","di_Hb_c","cr4de_di_quanti_hb_c","di_Hc_c","cr4de_di_quanti_hc_c","di_Sa_c","cr4de_di_quanti_sa_c","di_Sb_c","cr4de_di_quanti_sb_c","di_Sc_c","cr4de_di_quanti_sc_c","di_Sd_c","cr4de_di_quanti_sd_c","di_Ea_c","cr4de_di_quanti_ea_c","di_Fa_c","cr4de_di_quanti_fa_c","di_Fb_c","cr4de_di_quanti_fb_c","di_Ha_m","cr4de_di_quanti_ha_m","di_Hb_m","cr4de_di_quanti_hb_m","di_Hc_m","cr4de_di_quanti_hc_m","di_Sa_m","cr4de_di_quanti_sa_m","di_Sb_m","cr4de_di_quanti_sb_m","di_Sc_m","cr4de_di_quanti_sc_m","di_Sd_m","cr4de_di_quanti_sd_m","di_Ea_m","cr4de_di_quanti_ea_m","di_Fa_m","cr4de_di_quanti_fa_m","di_Fb_m","cr4de_di_quanti_fb_m","di_Ha_e","cr4de_di_quanti_ha_e","di_Hb_e","cr4de_di_quanti_hb_e","di_Hc_e","cr4de_di_quanti_hc_e","di_Sa_e","cr4de_di_quanti_sa_e","di_Sb_e","cr4de_di_quanti_sb_e","di_Sc_e","cr4de_di_quanti_sc_e","di_Sd_e","cr4de_di_quanti_sd_e","di_Ea_e","cr4de_di_quanti_ea_e","di_Fa_e","cr4de_di_quanti_fa_e","di_Fb_e","cr4de_di_quanti_fb_e","cr4de_climate_change_quanti_c","cr4de_climate_change_quanti_m","cr4de_climate_change_quanti_e","AVERAGE","MISSING","getConsensusRiskFile","cr4de_riskfilesid","riskTitle","timestamp","now","rp_c","rp_m","rp_e","di_Ha","di_Hb","di_Hc","di_Sa","di_Sb","di_Sc","di_Sd","di_Ea","di_Fa","di_Fb","ii_Ha_c","ii_Hb_c","ii_Hc_c","ii_Sa_c","ii_Sb_c","ii_Sc_c","ii_Sd_c","ii_Ea_c","ii_Fa_c","ii_Fb_c","ii_Ha_m","ii_Hb_m","ii_Hc_m","ii_Sa_m","ii_Sb_m","ii_Sc_m","ii_Sd_m","ii_Ea_m","ii_Fa_m","ii_Fb_m","ii_Ha_e","ii_Hb_e","ii_Hc_e","ii_Sa_e","ii_Sb_e","ii_Sc_e","ii_Sd_e","ii_Ea_e","ii_Fa_e","ii_Fb_e","ii_Ha","ii_Hb","ii_Hc","ii_Sa","ii_Sb","ii_Sc","ii_Sd","ii_Ea","ii_Fa","ii_Fb","ti_Ha_c","ti_Hb_c","ti_Hc_c","ti_Sa_c","ti_Sb_c","ti_Sc_c","ti_Sd_c","ti_Ea_c","ti_Fa_c","ti_Fb_c","ti_Ha_m","ti_Hb_m","ti_Hc_m","ti_Sa_m","ti_Sb_m","ti_Sc_m","ti_Sd_m","ti_Ea_m","ti_Fa_m","ti_Fb_m","ti_Ha_e","ti_Hb_e","ti_Hc_e","ti_Sa_e","ti_Sb_e","ti_Sc_e","ti_Sd_e","ti_Ea_e","ti_Fa_e","ti_Fb_e","ti_Ha","ti_Hb","ti_Hc","ti_Sa","ti_Sb","ti_Sc","ti_Sd","ti_Ea","ti_Fa","ti_Fb","calculationsDict","dict","cr4de_cause_hazard","_cr4de_cause_hazard_value","_cr4de_effect_hazard_value","cascadeCalculation","cascadeId","cr4de_bnrariskcascadeid","cascadeTitle","damp","cr4de_damp","c20","m20","e20","cTot","mTot","eTot","getNormalizedCascade","goodCAs","emailaddress1","cr4de_c2c","cr4de_c2e","cr4de_m2c","cr4de_m2e","cr4de_e2c","cr4de_e2e","cpScaleFactor","cr4de_hazard_id","extremeScaleFactor","reliabilty","cr4de_c2m","cr4de_m2m","cr4de_e2m","getConsensusCascade","runAnalysis","setCalculationProgress","graph","getEffectGraph","console","self","onmessage","calcs","data","progress","postMessage","type"],"sourceRoot":""}